<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Risk Difference • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Risk Difference">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Risk Difference</h1>
            
      

      <div class="d-none name"><code>riskdiff.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In clinical trials, adverse event tables typically display the
frequency of events by treatment group. While these counts are
informative on their own, regulatory reviewers and study teams often
want to see a direct statistical comparison between groups –
specifically, the difference in proportions and a confidence interval
around that difference. This quantity is the risk difference.</p>
<p>The risk difference answers a straightforward question: how much more
(or less) likely is an event in one group compared to another? A risk
difference of 10% with a 95% confidence interval of (2%, 18%) tells you
the event rate was 10 percentage points higher in the treatment group,
and you can be reasonably confident the true difference falls between 2
and 18 percentage points.</p>
<p>tplyr2 computes risk differences using
<code><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">stats::prop.test()</a></code> with no continuity correction, producing
an asymptotic Wald-type confidence interval. This is configured entirely
through the <code>risk_diff</code> parameter in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>, and the results appear as additional
columns in the output alongside the standard count summaries.</p>
</div>
<div class="section level2">
<h2 id="basic-risk-difference">Basic Risk Difference<a class="anchor" aria-label="anchor" href="#basic-risk-difference"></a>
</h2>
<p>To add a risk difference to a count layer, pass a
<code>risk_diff</code> list inside <code><a href="../reference/layer_settings.html">layer_settings()</a></code>. At
minimum, you need to specify which two treatment levels to compare via
the <code>comparisons</code> parameter.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"rdiff1"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="36%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">rdiff1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">1.8 (-4.2, 7.7)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">4 ( 8.0%)</td>
<td align="left">3.9 (-0.4, 8.2)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">3.1 (-3.4, 9.5)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1.3 (-1.2, 3.8)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
<td align="left">0.6 (-9.7, 10.8)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE REACTION</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">-0.8 (-5.7, 4.0)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE URTICARIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
</tbody>
</table>
<p>The risk difference appears in the <code>rdiff1</code> column. Each
comparison pair you specify produces one <code>rdiff</code> column,
numbered sequentially. The column carries a label attribute indicating
which groups were compared.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff1</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Xanomeline High Dose vs Placebo"</span></span></code></pre></div>
<p>Note the order of the comparison pair matters: the first element is
the treatment group and the second is the reference. The risk difference
is computed as the treatment proportion minus the reference proportion,
expressed as a percentage.</p>
</div>
<div class="section level2">
<h2 id="configuring-comparisons">Configuring Comparisons<a class="anchor" aria-label="anchor" href="#configuring-comparisons"></a>
</h2>
<p>You are not limited to a single comparison. When your study has
multiple active dose groups, you often want to compare each one against
placebo. Pass multiple pairs in the <code>comparisons</code> list.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline Low Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x)"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"rdiff1"</span>, <span class="st">"rdiff2"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="29%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="18%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">rdiff1</th>
<th align="left">rdiff2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="left">1.3 (-1.2, 3.9)</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="left">1.3 (-1.2, 3.9)</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="left">1.3 (-1.2, 3.9)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">1.8 (-4.2, 7.7)</td>
<td align="left">0.5 (-5.0, 6.0)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">4 ( 8.0%)</td>
<td align="left">3.9 (-0.4, 8.2)</td>
<td align="left">5.3 ( 0.2, 10.3)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">3.1 (-3.4, 9.5)</td>
<td align="left">0.5 (-5.0, 6.0)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1.3 (-1.2, 3.8)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
<td align="left">0.6 (-9.7, 10.8)</td>
<td align="left">-1.9 (-11.7, 7.8)</td>
</tr>
</tbody>
</table>
<p>The first comparison (<code>Xanomeline High Dose</code> vs
<code>Placebo</code>) goes into <code>rdiff1</code>, and the second
(<code>Xanomeline Low Dose</code> vs <code>Placebo</code>) goes into
<code>rdiff2</code>. Each column gets its own label.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff1</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Xanomeline High Dose vs Placebo"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff2</span>, <span class="st">"label"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Xanomeline Low Dose vs Placebo"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="formatting-output">Formatting Output<a class="anchor" aria-label="anchor" href="#formatting-output"></a>
</h2>
<p>The risk difference format is controlled through the
<code>format</code> parameter, which takes an <code><a href="../reference/f_str.html">f_str()</a></code>
object just like the count format strings. Four variables are available
for use in the format:</p>
<ul>
<li>
<code>rdiff</code> – the risk difference as a percentage</li>
<li>
<code>lower</code> – the lower bound of the confidence interval</li>
<li>
<code>upper</code> – the upper bound of the confidence interval</li>
<li>
<code>p_value</code> – the p-value from
<code><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test()</a></code>
</li>
</ul>
<p>When no format is specified, tplyr2 uses the default:
<code>f_str("xx.x (xx.x, xx.x)", "rdiff", "lower", "upper")</code>.</p>
<p>You can include the p-value in the formatted string if your table
requires it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x) [x.xxxx]"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>, <span class="st">"p_value"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"rdiff1"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="33%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">rdiff1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0) [ ]</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0) [ ]</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0) [ ]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">1.8 (-4.2, 7.7) [0.5887]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">4 ( 8.0%)</td>
<td align="left">3.9 (-0.4, 8.2) [0.1707]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">2 ( 4.0%)</td>
<td align="left">3.1 (-3.4, 9.5) [0.3996]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1.3 (-1.2, 3.8) [0.4328]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
<td align="left">0.6 (-9.7, 10.8) [0.9122]</td>
</tr>
</tbody>
</table>
<p>The <code>x</code> characters in the format string control field
width, just as they do for count format strings. Each <code>x</code>
reserves one character position, so <code>xx.x</code> gives one decimal
place with room for a two-digit integer part. You can adjust the
precision to match your table shell requirements.</p>
</div>
<div class="section level2">
<h2 id="confidence-interval-level">Confidence Interval Level<a class="anchor" aria-label="anchor" href="#confidence-interval-level"></a>
</h2>
<p>By default, tplyr2 computes a 95% confidence interval. You can change
this with the <code>ci</code> parameter.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          ci <span class="op">=</span> <span class="fl">0.90</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x)"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rdiff1"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rdiff1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1.8 (-3.2, 6.8)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">3.9 ( 0.3, 7.5)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">3.1 (-2.3, 8.5)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">1.3 (-0.8, 3.4)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">0.6 (-8.0, 9.2)</td>
</tr>
</tbody>
</table>
<p>A 90% interval is narrower than a 95% interval for the same data. The
confidence level you choose should match your study’s statistical
analysis plan.</p>
</div>
<div class="section level2">
<h2 id="risk-difference-with-distinct-counts">Risk Difference with Distinct Counts<a class="anchor" aria-label="anchor" href="#risk-difference-with-distinct-counts"></a>
</h2>
<p>Risk difference calculations naturally work with the
<code>distinct_by</code> setting. When <code>distinct_by</code> is
specified, the proportions used for the risk difference are based on
distinct subject counts rather than event counts. This is almost always
what you want for adverse event tables, where a single subject can
contribute multiple events.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%) [xxx]"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x)"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"rdiff1"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="30%">
<col width="17%">
<col width="17%">
<col width="17%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">rdiff1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
<td align="left">1.8 (-4.2, 7.7)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">4 ( 8.0%) [ 4]</td>
<td align="left">3.9 (-0.4, 8.2)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 4]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
<td align="left">3.1 (-3.4, 9.5)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.3%) [ 1]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1.3 (-1.2, 3.8)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%) [ 4]</td>
<td align="left">6 (14.0%) [ 7]</td>
<td align="left">5 (10.0%) [ 5]</td>
<td align="left">0.6 (-9.7, 10.8)</td>
</tr>
</tbody>
</table>
<p>In this output, the count columns show distinct subjects, their
percentage, and the total event count in brackets. The risk difference
is computed from the distinct subject proportions, which is the
clinically meaningful comparison.</p>
</div>
<div class="section level2">
<h2 id="interaction-with-special-rows">Interaction with Special Rows<a class="anchor" aria-label="anchor" href="#interaction-with-special-rows"></a>
</h2>
<p>An important detail: risk differences are computed before special
rows (total rows and missing rows) are appended. This means total and
missing rows will have empty risk difference values, which is the
expected behavior – a risk difference on a total row is not
meaningful.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        total_row <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        total_row_label <span class="op">=</span> <span class="st">"Any adverse event"</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x)"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="co"># Show the last few rows including the total row</span></span>
<span><span class="va">tail_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"rdiff1"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tail_rows</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="34%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">rdiff1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">85</td>
<td align="left">URTICARIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">2.6 (-1.0, 6.2)</td>
</tr>
<tr class="even">
<td align="left">86</td>
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1.3 (-1.2, 3.8)</td>
</tr>
<tr class="odd">
<td align="left">87</td>
<td align="left">VENTRICULAR SEPTAL DEFECT</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1.3 (-1.2, 3.8)</td>
</tr>
<tr class="even">
<td align="left">88</td>
<td align="left">VOMITING</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 4.7%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2.6 (-1.0, 6.2)</td>
</tr>
<tr class="odd">
<td align="left">89</td>
<td align="left">WOUND</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
</tr>
</tbody>
</table>
<p>The “Any adverse event” row has an empty <code>rdiff1</code> value
because it is a total row added after the risk difference
computation.</p>
</div>
<div class="section level2">
<h2 id="extracting-raw-numbers">Extracting Raw Numbers<a class="anchor" aria-label="anchor" href="#extracting-raw-numbers"></a>
</h2>
<p>The formatted risk difference strings are useful for display, but
sometimes you need the underlying numeric values for further analysis or
custom formatting. The <code><a href="../reference/tplyr_numeric_data.html">tplyr_numeric_data()</a></code> function gives
you access to the raw counts that were used to compute the risk
differences.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        risk_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Placebo"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          format <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.x, xx.x)"</span>, <span class="st">"rdiff"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_numeric_data.html">tplyr_numeric_data</a></span><span class="op">(</span><span class="va">result</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nd</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="30%">
<col width="3%">
<col width="11%">
<col width="9%">
<col width="13%">
<col width="6%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">TRTA</th>
<th align="left">AEDECOD</th>
<th align="right">n</th>
<th align="right">distinct_n</th>
<th align="right">pct</th>
<th align="right">distinct_pct</th>
<th align="right">total</th>
<th align="right">distinct_total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">ABDOMINAL PAIN</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">AGITATION</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">ANXIETY</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.127660</td>
<td align="right">3.125</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.127660</td>
<td align="right">3.125</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE PAIN</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">8.510638</td>
<td align="right">12.500</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE REACTION</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.127660</td>
<td align="right">3.125</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">APPLICATION SITE URTICARIA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.000000</td>
<td align="right">0.000</td>
<td align="right">47</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<p>This data.frame contains the raw counts, percentages, and
denominators per treatment group and preferred term. These are the
values that feed into the <code><a href="https://rdrr.io/r/stats/prop.test.html" class="external-link">prop.test()</a></code> calls.</p>
<p>You can also extract numeric values directly from the formatted risk
difference strings using <code><a href="../reference/str_extract_num.html">str_extract_num()</a></code>. This function
pulls the nth number from a formatted string.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract the risk difference value (1st number)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">rdiff_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/str_extract_num.html">str_extract_num</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the lower CI bound (2nd number)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">rdiff_lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/str_extract_num.html">str_extract_num</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the upper CI bound (3rd number)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">rdiff_upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/str_extract_num.html">str_extract_num</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rdiff1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rdiff1"</span>, <span class="st">"rdiff_value"</span>, <span class="st">"rdiff_lower"</span>, <span class="st">"rdiff_upper"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="34%">
<col width="20%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rdiff1</th>
<th align="right">rdiff_value</th>
<th align="right">rdiff_lower</th>
<th align="right">rdiff_upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0.0 ( 0.0, 0.0)</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
<td align="right">0.0</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1.8 (-4.2, 7.7)</td>
<td align="right">1.8</td>
<td align="right">-4.2</td>
<td align="right">7.7</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">3.9 (-0.4, 8.2)</td>
<td align="right">3.9</td>
<td align="right">-0.4</td>
<td align="right">8.2</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">3.1 (-3.4, 9.5)</td>
<td align="right">3.1</td>
<td align="right">-3.4</td>
<td align="right">9.5</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">1.3 (-1.2, 3.8)</td>
<td align="right">1.3</td>
<td align="right">-1.2</td>
<td align="right">3.8</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">0.6 (-9.7, 10.8)</td>
<td align="right">0.6</td>
<td align="right">-9.7</td>
<td align="right">10.8</td>
</tr>
</tbody>
</table>
<p>This approach is useful when you need numeric risk difference values
for downstream tasks like sorting, filtering, or creating forest
plots.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Risk difference in tplyr2 is configured entirely through the
<code>risk_diff</code> parameter in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>. The
key points to remember:</p>
<ul>
<li>
<strong>Comparisons</strong> are specified as pairs of treatment
levels, with the first element as the treatment and the second as the
reference.</li>
<li>
<strong>Multiple comparisons</strong> each produce a separate
<code>rdiff</code> column (<code>rdiff1</code>, <code>rdiff2</code>,
etc.).</li>
<li>
<strong>Formatting</strong> uses <code><a href="../reference/f_str.html">f_str()</a></code> with the
variables <code>rdiff</code>, <code>lower</code>, <code>upper</code>,
and <code>p_value</code>.</li>
<li>
<strong>Confidence level</strong> defaults to 0.95 and is adjustable
via the <code>ci</code> parameter.</li>
<li>Risk differences are computed <strong>before</strong> special rows
(total, missing), so those rows have empty risk difference values.</li>
<li>Raw count data is accessible through
<code><a href="../reference/tplyr_numeric_data.html">tplyr_numeric_data()</a></code>, and formatted values can be parsed
with <code><a href="../reference/str_extract_num.html">str_extract_num()</a></code>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
