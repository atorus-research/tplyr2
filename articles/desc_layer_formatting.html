<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Descriptive Statistics Formatting • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Advanced Descriptive Statistics Formatting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Advanced Descriptive Statistics Formatting</h1>
            
      

      <div class="d-none name"><code>desc_layer_formatting.Rmd</code></div>
    </div>

    
    
<p>This vignette covers advanced formatting for
<code><a href="../reference/group_desc.html">group_desc()</a></code> layers: empty value handling, auto-precision,
precision capping, external precision data, and parenthesis hugging. For
fundamentals (built-in/custom summaries, multi-variable analysis), see
<code><a href="../articles/desc.html">vignette("desc")</a></code>.</p>
<div class="section level2">
<h2 id="empty-value-formatting">Empty Value Formatting<a class="anchor" aria-label="anchor" href="#empty-value-formatting"></a>
</h2>
<p>When all observations in a group are <code>NA</code>, tplyr2 fills
the cell with whitespace by default. The <code>empty</code> parameter of
<code><a href="../reference/f_str.html">f_str()</a></code> overrides this. Use <code>.overall</code> to
replace the entire formatted string:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  TRT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  VAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">3.1</span>, <span class="fl">4.0</span>, <span class="fl">2.7</span>,</span>
<span>          <span class="fl">5.2</span>, <span class="fl">6.1</span>, <span class="fl">3.8</span>, <span class="fl">4.4</span>, <span class="fl">7.0</span>,</span>
<span>          <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"VAL"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>,</span>
<span>                              empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>.overall <span class="op">=</span> <span class="st">"---"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x"</span>, <span class="st">"median"</span>,</span>
<span>                              empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>.overall <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">n</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">Mean (SD)</td>
<td align="left">2.7 ( 0.93)</td>
<td align="left">5.3 ( 1.28)</td>
<td align="left">—</td>
</tr>
<tr class="odd">
<td align="left">Median</td>
<td align="left">2.7</td>
<td align="left">5.2</td>
<td align="left">NE</td>
</tr>
</tbody>
</table>
<p>Group C has all-NA values, so Mean (SD) shows “—” and Median shows
“NE”. Each <code><a href="../reference/f_str.html">f_str()</a></code> can specify its own replacement string
independently.</p>
</div>
<div class="section level2">
<h2 id="auto-precision">Auto-Precision<a class="anchor" aria-label="anchor" href="#auto-precision"></a>
</h2>
<p>Fixed format strings like <code>"xx.x"</code> work when you know the
data’s scale. But lab parameters vary widely in precision. The
auto-precision system lets the data determine how many digits to
display.</p>
<div class="section level3">
<h3 id="core-settings">Core Settings<a class="anchor" aria-label="anchor" href="#core-settings"></a>
</h3>
<p>Two <code><a href="../reference/layer_settings.html">layer_settings()</a></code> parameters drive
auto-precision:</p>
<ul>
<li>
<code>precision_on</code>: the variable scanned for decimal
precision (defaults to the target variable)</li>
<li>
<code>precision_by</code>: grouping variables that define
independent precision groups</li>
</ul>
<p>For each group, tplyr2 computes <code>max_int</code> (maximum integer
digits) and <code>max_dec</code> (maximum meaningful decimal places)
from the data.</p>
</div>
<div class="section level3">
<h3 id="the-a-character">The <code>a</code> Character<a class="anchor" aria-label="anchor" href="#the-a-character"></a>
</h3>
<p>In format strings, lowercase <code>a</code> means “use the
data-driven width”:</p>
<ul>
<li>
<code>a.a</code> resolves to <code>max_int</code> integer digits and
<code>max_dec</code> decimal places</li>
<li>
<code>a.a+1</code> adds one extra decimal place beyond the data’s
precision</li>
<li>
<code>a+2.a</code> adds two extra integer digits</li>
</ul>
<p>The <code>+N</code> suffix is standard clinical practice – typically
the mean gets <code>+1</code> and the SD gets <code>+2</code> beyond the
raw data’s precision.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1 (a.a+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a, a.a"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Missing"</span>   <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"missing"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">n</td>
<td align="left">75</td>
<td align="left">78</td>
<td align="left">47</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.2230 ( 64.96877)</td>
<td align="left">298.8489 ( 55.54287)</td>
<td align="left">287.1492 ( 76.82208)</td>
</tr>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Median</td>
<td align="left">303.3480</td>
<td align="left">300.3740</td>
<td align="left">267.6600</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Min, Max</td>
<td align="left">226.024, 469.892</td>
<td align="left">178.440, 481.788</td>
<td align="left">178.440, 463.944</td>
</tr>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Missing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>Since <code>AVAL</code> in <code>tplyr_adlb</code> has three decimal
places, <code>a.a</code> resolves to three decimals. The mean
(<code>a.a+1</code>) displays four, and the SD (<code>a.a+2</code>)
displays five.</p>
</div>
</div>
<div class="section level2">
<h2 id="precision-capping">Precision Capping<a class="anchor" aria-label="anchor" href="#precision-capping"></a>
</h2>
<p>Auto-precision can produce unreasonably wide columns when data has
extreme precision. Capping sets upper bounds on the resolved widths.</p>
<div class="section level3">
<h3 id="layer-level-cap">Layer-Level Cap<a class="anchor" aria-label="anchor" href="#layer-level-cap"></a>
</h3>
<p>Set <code>precision_cap</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code> as a
named vector with <code>int</code> and/or <code>dec</code>
components:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        precision_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>int <span class="op">=</span> <span class="fl">3</span>, dec <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1 (a.a+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a, a.a"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="24%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.223 ( 64.9688)</td>
<td align="left">298.849 ( 55.5429)</td>
<td align="left">287.149 ( 76.8221)</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Min, Max</td>
<td align="left">226.02, 469.89</td>
<td align="left">178.44, 481.79</td>
<td align="left">178.44, 463.94</td>
</tr>
</tbody>
</table>
<p>With <code>dec = 2</code>, the base precision is capped at two
decimals. The mean shows three (<code>+1</code>), the SD shows four
(<code>+2</code>), and Min/Max uses the capped base of two.</p>
</div>
<div class="section level3">
<h3 id="global-cap">Global Cap<a class="anchor" aria-label="anchor" href="#global-cap"></a>
</h3>
<p>Use <code><a href="../reference/tplyr2_options.html">tplyr2_options()</a></code> to set a session-wide cap:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>precision_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>int <span class="op">=</span> <span class="fl">3</span>, dec <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="24%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.223 ( 64.9688)</td>
<td align="left">298.849 ( 55.5429)</td>
<td align="left">287.149 ( 76.8221)</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Min, Max</td>
<td align="left">226.02, 469.89</td>
<td align="left">178.44, 481.79</td>
<td align="left">178.44, 463.94</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>precision_cap <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>A layer-level cap always overrides the global option, so you can set
conservative session defaults and widen specific layers as needed.</p>
</div>
</div>
<div class="section level2">
<h2 id="external-precision-data">External Precision Data<a class="anchor" aria-label="anchor" href="#external-precision-data"></a>
</h2>
<p>When precision is predetermined by a statistical analysis plan,
supply it directly via <code>precision_data</code> – a data.frame with
<code>max_int</code> and <code>max_dec</code> columns, plus any
<code>precision_by</code> grouping columns:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext_precision</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  PARAMCD <span class="op">=</span> <span class="st">"URATE"</span>,</span>
<span>  max_int <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  max_dec <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        precision_data <span class="op">=</span> <span class="va">ext_precision</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1 (a.a+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a, a.a"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="23%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.22 ( 64.969)</td>
<td align="left">298.85 ( 55.543)</td>
<td align="left">287.15 ( 76.822)</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Min, Max</td>
<td align="left">226.0, 469.9</td>
<td align="left">178.4, 481.8</td>
<td align="left">178.4, 463.9</td>
</tr>
</tbody>
</table>
<p>With <code>max_dec = 1</code>, the mean shows two decimals
(<code>+1</code>) and Min/Max shows one, regardless of the data’s actual
three-decimal precision.</p>
</div>
<div class="section level2">
<h2 id="parenthesis-hugging">Parenthesis Hugging<a class="anchor" aria-label="anchor" href="#parenthesis-hugging"></a>
</h2>
<p>Standard formatting pads numbers with leading spaces for alignment,
which can create gaps like <code>( 5.2)</code>. Parenthesis hugging
shifts those leading spaces to after the number, producing
<code>(5.2 )</code> instead.</p>
<div class="section level3">
<h3 id="the-x-and-a-characters">The <code>X</code> and <code>A</code> Characters<a class="anchor" aria-label="anchor" href="#the-x-and-a-characters"></a>
</h3>
<p>Uppercase characters activate hugging:</p>
<ul>
<li>
<code>X</code> – fixed width with hugging (uppercase
<code>x</code>)</li>
<li>
<code>A</code> – auto-precision with hugging (uppercase
<code>a</code>)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Standard"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Hugged"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (XX.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Standard</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
</tr>
<tr class="even">
<td align="left">Hugged</td>
<td align="left">75.2 (8.59 )</td>
<td align="left">74.4 (7.89 )</td>
<td align="left">75.7 (8.29 )</td>
</tr>
</tbody>
</table>
<p>In “Standard”, the SD has leading spaces before the number inside the
parentheses. In “Hugged”, those spaces shift after the number so the
parenthesis sits flush against the first digit.</p>
</div>
<div class="section level3">
<h3 id="hugging-with-auto-precision">Hugging with Auto-Precision<a class="anchor" aria-label="anchor" href="#hugging-with-auto-precision"></a>
</h3>
<p>Uppercase <code>A</code> combines auto-precision with hugging:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1 (A.A+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min [Max]"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a [A.a]"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.2230 (64.96877 )</td>
<td align="left">298.8489 (55.54287 )</td>
<td align="left">287.1492 (76.82208 )</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Min [Max]</td>
<td align="left">226.024 [469.892]</td>
<td align="left">178.440 [481.788]</td>
<td align="left">178.440 [463.944]</td>
</tr>
</tbody>
</table>
<p>The mean uses lowercase <code>a</code> (standard padding) while the
SD uses uppercase <code>A</code> (hugged). The combination of
auto-precision for data-driven width plus hugging for tight delimiters
is the standard approach for publication-quality lab tables.</p>
</div>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting It All Together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>A complete specification combining all the formatting features
covered here:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_by <span class="op">=</span> <span class="st">"PARAMCD"</span>,</span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        precision_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>int <span class="op">=</span> <span class="fl">4</span>, dec <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1 (A.A+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>,</span>
<span>                              empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>.overall <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1"</span>, <span class="st">"median"</span>,</span>
<span>                              empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>.overall <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="st">"Q1, Q3"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a+1, a.a+1"</span>, <span class="st">"q1"</span>, <span class="st">"q3"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a, a.a"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Missing"</span>   <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"missing"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">n</td>
<td align="left">75</td>
<td align="left">78</td>
<td align="left">47</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Mean (SD)</td>
<td align="left">322.2230 (64.96877 )</td>
<td align="left">298.8489 (55.54287 )</td>
<td align="left">287.1492 (76.82208 )</td>
</tr>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Median</td>
<td align="left">303.3480</td>
<td align="left">300.3740</td>
<td align="left">267.6600</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Q1, Q3</td>
<td align="left">267.6600, 383.6460</td>
<td align="left">255.7640, 321.1920</td>
<td align="left">237.9200, 303.3480</td>
</tr>
<tr class="odd">
<td align="left">URATE</td>
<td align="left">Min, Max</td>
<td align="left">226.024, 469.892</td>
<td align="left">178.440, 481.788</td>
<td align="left">178.440, 463.944</td>
</tr>
<tr class="even">
<td align="left">URATE</td>
<td align="left">Missing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>This specification adapts decimal places to the data, caps precision
at three decimals, hugs the SD against its opening parenthesis, and
provides meaningful fill strings for all-NA groups.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
