<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Denominators • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Denominators">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Denominators</h1>
            
      

      <div class="d-none name"><code>denom.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When a clinical table displays a percentage, the natural question is:
a percentage of what? The denominator – the number in the bottom of that
fraction – drives the interpretation of every count cell in your output.
A disposition table typically uses the total number of subjects in each
treatment arm. An adverse event table stratified by gender might need
the number of subjects within each treatment-by-gender combination. A
subgroup analysis might exclude certain categories from the denominator
entirely.</p>
<p>tplyr2 provides several mechanisms for controlling denominators in
count layers, all configured through <code><a href="../reference/layer_settings.html">layer_settings()</a></code>. This
vignette walks through each one, starting with the default behavior and
building up to more specialized scenarios.</p>
</div>
<div class="section level2">
<h2 id="default-behavior">Default Behavior<a class="anchor" aria-label="anchor" href="#default-behavior"></a>
</h2>
<p>By default, tplyr2 uses the column variable total as the denominator.
If your spec uses <code>cols = "TRT01P"</code>, then the denominator for
each cell is the total number of rows in that treatment group.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"RACE"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">9 (10.7%)</td>
<td align="left">6 ( 7.1%)</td>
</tr>
<tr class="odd">
<td align="left">WHITE</td>
<td align="left">78 (90.7%)</td>
<td align="left">74 (88.1%)</td>
<td align="left">78 (92.9%)</td>
</tr>
</tbody>
</table>
<p>Each percentage is computed against the total count within its
column. For the Placebo arm, there are 86 subjects, so the WHITE row
shows <code>78 (90.7%)</code> because 78 / 86 = 90.7%.</p>
<p>This default is appropriate for most simple tables, but many
real-world scenarios call for something different.</p>
</div>
<div class="section level2">
<h2 id="controlling-denominator-grouping-with-denoms_by">Controlling Denominator Grouping with <code>denoms_by</code><a class="anchor" aria-label="anchor" href="#controlling-denominator-grouping-with-denoms_by"></a>
</h2>
<p>The <code>denoms_by</code> parameter in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>
lets you specify exactly which variables define the denominator groups.
When you add a <code>by</code> variable to a count layer, the default
denominator is still the column total. But sometimes you want the
percentage to reflect the subgroup population instead.</p>
<p>Consider a disposition table broken out by sex. With the default
denominator, each cell percentage is based on the total treatment arm
count:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"SEX"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="39%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="left">ADVERSE EVENT</td>
<td align="left">6 ( 7.0%)</td>
<td align="left">20 (23.8%)</td>
<td align="left">26 (31.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">COMPLETED</td>
<td align="left">34 (39.5%)</td>
<td align="left">13 (15.5%)</td>
<td align="left">17 (20.2%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">DEATH</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">LACK OF EFFICACY</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">6 ( 7.0%)</td>
<td align="left">4 ( 4.8%)</td>
<td align="left">5 ( 6.0%)</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">ADVERSE EVENT</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">20 (23.8%)</td>
<td align="left">18 (21.4%)</td>
</tr>
</tbody>
</table>
<p>Here the percentages use the full treatment arm as the denominator.
But if you want each sex subgroup to sum to 100% independently, set
<code>denoms_by</code> to include both the column variable and the
<code>by</code> variable:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"SEX"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        denoms_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRT01P"</span>, <span class="st">"SEX"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="39%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">F</td>
<td align="left">ADVERSE EVENT</td>
<td align="left">6 (11.3%)</td>
<td align="left">20 (50.0%)</td>
<td align="left">26 (52.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">COMPLETED</td>
<td align="left">34 (64.2%)</td>
<td align="left">13 (32.5%)</td>
<td align="left">17 (34.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">DEATH</td>
<td align="left">1 ( 1.9%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">LACK OF EFFICACY</td>
<td align="left">2 ( 3.8%)</td>
<td align="left">1 ( 2.5%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.9%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.9%)</td>
<td align="left">1 ( 2.5%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">1 ( 1.9%)</td>
<td align="left">1 ( 2.5%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">1 ( 1.9%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">6 (11.3%)</td>
<td align="left">4 (10.0%)</td>
<td align="left">5 (10.0%)</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">ADVERSE EVENT</td>
<td align="left">2 ( 6.1%)</td>
<td align="left">20 (45.5%)</td>
<td align="left">18 (52.9%)</td>
</tr>
</tbody>
</table>
<p>Now the denominator for each cell is the count of subjects in that
specific treatment-by-sex combination. The female Placebo subjects have
their own denominator, the male Placebo subjects have theirs, and so on.
Within each sex-by-treatment group, the percentages will sum to
100%.</p>
<p>The <code>denoms_by</code> parameter accepts any character vector of
variable names present in the data. You are not restricted to column or
<code>by</code> variables – you could use any grouping that makes sense
for your analysis.</p>
</div>
<div class="section level2">
<h2 id="separate-denominator-populations-with-denom_where">Separate Denominator Populations with <code>denom_where</code><a class="anchor" aria-label="anchor" href="#separate-denominator-populations-with-denom_where"></a>
</h2>
<p>Sometimes the denominator should come from a different subset of the
data than the numerator. The <code>denom_where</code> parameter accepts
a quoted expression that filters the data used for denominator
computation, while leaving the numerator counts unaffected.</p>
<p>For example, suppose you want to show all disposition categories but
compute percentages relative to subjects who did not complete the
study:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        denom_where <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">DCDECOD</span> <span class="op">!=</span> <span class="st">"COMPLETED"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 (28.6%)</td>
<td align="left">40 (70.2%)</td>
<td align="left">44 (74.6%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (207.1%)</td>
<td align="left">27 (47.4%)</td>
<td align="left">25 (42.4%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 7.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.7%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 (10.7%)</td>
<td align="left">1 ( 1.8%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 3.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.7%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 3.6%)</td>
<td align="left">2 ( 3.5%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 7.1%)</td>
<td align="left">3 ( 5.3%)</td>
<td align="left">1 ( 1.7%)</td>
</tr>
<tr class="even">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 7.1%)</td>
<td align="left">3 ( 5.3%)</td>
<td align="left">2 ( 3.4%)</td>
</tr>
<tr class="odd">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 (32.1%)</td>
<td align="left">8 (14.0%)</td>
<td align="left">10 (16.9%)</td>
</tr>
</tbody>
</table>
<p>Notice that the COMPLETED row now shows percentages exceeding 100%.
That is because the numerator (subjects who completed) is larger than
the denominator (subjects who did not complete). This is expected when
using <code>denom_where</code> – it shifts the frame of reference for
the percentage calculation without changing which rows appear in the
count.</p>
<p>This feature is particularly useful in adverse event tables where you
might want to restrict the denominator to the safety population or to
subjects who received at least one dose of study medication.</p>
</div>
<div class="section level2">
<h2 id="excluding-values-from-denominators-with-denom_ignore">Excluding Values from Denominators with
<code>denom_ignore</code><a class="anchor" aria-label="anchor" href="#excluding-values-from-denominators-with-denom_ignore"></a>
</h2>
<p>The <code>denom_ignore</code> parameter removes specific values of
the target variable from the denominator calculation. Unlike
<code>denom_where</code>, which filters rows based on an arbitrary
condition, <code>denom_ignore</code> targets specific levels of the
variable being counted.</p>
<p>This is useful when a categorical variable includes a level like “NOT
APPLICABLE” or “NOT ASSESSED” that should not contribute to the total.
Here we exclude “AMERICAN INDIAN OR ALASKA NATIVE” from the denominator
when counting race categories:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"RACE"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        denom_ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AMERICAN INDIAN OR ALASKA NATIVE"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">AMERICAN INDIAN OR ALASKA NATIVE</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BLACK OR AFRICAN AMERICAN</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">9 (10.8%)</td>
<td align="left">6 ( 7.1%)</td>
</tr>
<tr class="odd">
<td align="left">WHITE</td>
<td align="left">78 (90.7%)</td>
<td align="left">74 (89.2%)</td>
<td align="left">78 (92.9%)</td>
</tr>
</tbody>
</table>
<p>The “AMERICAN INDIAN OR ALASKA NATIVE” row still appears in the
output with its count, but subjects in that category are excluded from
the denominator used to calculate all percentages. This means the
remaining categories will have percentages that sum to slightly more
than 100% (because the “AMERICAN INDIAN OR ALASKA NATIVE” count was
removed from the bottom of the fraction but included in the numerator
for its own row).</p>
<p>You can pass multiple values to <code>denom_ignore</code> as a
character vector.</p>
</div>
<div class="section level2">
<h2 id="denominators-with-distinct-counts">Denominators with Distinct Counts<a class="anchor" aria-label="anchor" href="#denominators-with-distinct-counts"></a>
</h2>
<p>When <code>distinct_by</code> is set in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>, tplyr2 computes both event-level and
subject-level counts. The denominator system applies separately to
each:</p>
<ul>
<li>
<code>n</code> and <code>pct</code> use the event-level (row-level)
denominator</li>
<li>
<code>distinct_n</code> and <code>distinct_pct</code> use the
distinct-subject denominator</li>
</ul>
<p>Both denominators respect <code>denoms_by</code>,
<code>denom_where</code>, and <code>denom_ignore</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%) [xxx]"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="36%">
<col width="21%">
<col width="21%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">4 ( 8.0%) [ 4]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 4]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.3%) [ 1]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%) [ 4]</td>
<td align="left">6 (14.0%) [ 7]</td>
<td align="left">5 (10.0%) [ 5]</td>
</tr>
</tbody>
</table>
<p>The first number is the count of distinct subjects, the percentage is
the proportion of distinct subjects, and the bracketed number is the
total event count. The denominators for <code>distinct_n</code> and
<code>distinct_pct</code> are the total number of distinct subjects per
treatment arm (rather than the total number of event rows).</p>
</div>
<div class="section level2">
<h2 id="denominators-with-population-data">Denominators with Population Data<a class="anchor" aria-label="anchor" href="#denominators-with-population-data"></a>
</h2>
<p>In many clinical studies, the analysis data contains only a subset of
the randomized population. Adverse event data, for example, only
includes subjects who experienced at least one event. If you compute
denominators from the event data alone, you will undercount the
population.</p>
<p>The <code><a href="../reference/pop_data.html">pop_data()</a></code> configuration at the spec level tells
tplyr2 to draw denominators from a separate population dataset. When
<code>pop_data</code> is specified, the denominator for each treatment
arm comes from the population dataset rather than the analysis data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="fu"><a href="../reference/pop_data.html">pop_data</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRTA"</span> <span class="op">=</span> <span class="st">"TRT01P"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span>, pop_data <span class="op">=</span> <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">4 ( 4.8%)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 ( 4.7%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="left">5 ( 6.0%)</td>
</tr>
</tbody>
</table>
<p>Without <code>pop_data</code>, the denominators come from the AE
dataset itself. With it, they come from the full ADSL population. This
typically produces smaller percentages because the denominator is larger
– it includes all randomized subjects, not just those with events.</p>
<p>The named vector in
<code>pop_data(cols = c("TRTA" = "TRT01P"))</code> maps the analysis
data column name (<code>TRTA</code>) to the corresponding population
data column name (<code>TRT01P</code>). This mapping is necessary when
the column variables have different names across datasets.</p>
<p>You can also retrieve the population-level N values used in column
headers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/tplyr_header_n.html">tplyr_header_n</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">TRTA</th>
<th align="right">.n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Placebo</td>
<td align="right">86</td>
</tr>
<tr class="even">
<td align="left">Xanomeline High Dose</td>
<td align="right">84</td>
</tr>
<tr class="odd">
<td align="left">Xanomeline Low Dose</td>
<td align="right">84</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="missing-subjects">Missing Subjects<a class="anchor" aria-label="anchor" href="#missing-subjects"></a>
</h2>
<p>When using population data, some subjects in the population may not
appear in the analysis data at all. The <code>missing_subjects</code>
parameter adds a row that counts these absent subjects.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="fu"><a href="../reference/pop_data.html">pop_data</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRTA"</span> <span class="op">=</span> <span class="st">"TRT01P"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        missing_subjects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        missing_subjects_label <span class="op">=</span> <span class="st">"Not reported"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span>, pop_data <span class="op">=</span> <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the "Not reported" row</span></span>
<span><span class="va">nr_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rowlabel1</span> <span class="op">==</span> <span class="st">"Not reported"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="va">nr_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">63</td>
<td align="left">Not reported</td>
<td align="left">54 (62.8%)</td>
<td align="left">41 (48.8%)</td>
<td align="left">34 (40.5%)</td>
</tr></tbody>
</table>
<p>The “Not reported” row counts subjects who are present in the
population (ADSL) but have no records in the analysis data (ADAE). This
is particularly important for adverse event tables, where a large
proportion of the safety population may have no reported events.</p>
<p>The <code>missing_subjects_label</code> parameter controls the text
displayed in the row label. It defaults to <code>"Missing"</code>, but
<code>"Not reported"</code> or <code>"No events reported"</code> are
common alternatives for adverse event tables.</p>
<p>Note that <code>missing_subjects</code> requires
<code>pop_data</code> to be set at the spec level. Without a separate
population dataset, there is no reference population to identify missing
subjects against.</p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting It All Together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>In practice, you often combine several of these features in a single
layer. Here is a more complete adverse event summary that uses
population-based denominators, distinct subject counts, and a missing
subjects row:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  pop_data <span class="op">=</span> <span class="fu"><a href="../reference/pop_data.html">pop_data</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRTA"</span> <span class="op">=</span> <span class="st">"TRT01P"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  total_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/total_group.html">total_group</a></span><span class="op">(</span><span class="st">"TRTA"</span>, label <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        missing_subjects <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        missing_subjects_label <span class="op">=</span> <span class="st">"No events reported"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span>, pop_data <span class="op">=</span> <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="va">collapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_row_labels.html">collapse_row_labels</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, indent <span class="op">=</span> <span class="st">"   "</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the first section plus the missing subjects row</span></span>
<span><span class="va">nr_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">collapsed</span><span class="op">$</span><span class="va">row_label</span> <span class="op">==</span> <span class="st">"No events reported"</span><span class="op">)</span></span>
<span><span class="va">show_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="va">nr_idx</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">collapsed</span><span class="op">[</span><span class="va">show_rows</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row_label"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"res4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="43%">
<col width="13%">
<col width="15%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">row_label</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">4 ( 4.7%)</td>
<td align="left">15 ( 0.0%)</td>
<td align="left">6 ( 7.1%)</td>
<td align="left">5 ( 6.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">4 ( 0.0%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="odd">
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">TACHYCARDIA</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
</tbody>
</table>
<p>This spec includes population-based denominators from ADSL, a “Total”
column, nested body system / preferred term counts, and a row for
subjects with no reported events. The denominator for every cell comes
from the full population dataset, so the percentages reflect the
proportion of all randomized subjects in each arm.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The table below summarizes the denominator controls available in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>:</p>
<table class="table">
<colgroup>
<col width="37%">
<col width="31%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Purpose</th>
<th>Default</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>denoms_by</code></td>
<td>Variables defining denominator groups</td>
<td>Column variable(s)</td>
</tr>
<tr class="even">
<td><code>denom_where</code></td>
<td>Expression to filter denominator data</td>
<td>No filter</td>
</tr>
<tr class="odd">
<td><code>denom_ignore</code></td>
<td>Target variable values to exclude from denominators</td>
<td>None</td>
</tr>
<tr class="even">
<td><code>distinct_by</code></td>
<td>Variable for distinct subject counting</td>
<td>NULL (event-level only)</td>
</tr>
<tr class="odd">
<td><code>missing_subjects</code></td>
<td>Add row for subjects absent from analysis data</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td><code><a href="../reference/pop_data.html">pop_data()</a></code></td>
<td>Separate population dataset for denominators</td>
<td>None (use analysis data)</td>
</tr>
</tbody>
</table>
<p>Each of these can be used independently or combined as needed. The
key principle is that the numerator (what you are counting) and the
denominator (what you are dividing by) can be controlled separately,
giving you precise control over how percentages are computed in your
clinical tables.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
