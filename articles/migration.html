<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Migrating from Tplyr v1 • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Migrating from Tplyr v1">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Migrating from Tplyr v1</h1>
            
      

      <div class="d-none name"><code>migration.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Both Tplyr v1 and tplyr2 build formatted clinical summary tables from
ADaM-style data, but they take fundamentally different approaches.</p>
<p><strong>Tplyr v1</strong> uses an imperative, piped workflow: create
a table object holding data and configuration, pipe in layers, set
options with modifier functions, then call <code>build()</code>.</p>
<p><strong>tplyr2</strong> uses a declarative, spec-based approach:
build a <code><a href="../reference/tplyr_spec.html">tplyr_spec()</a></code> that is pure configuration (no data,
no side effects), then supply data at build time via
<code>tplyr_build(spec, data)</code>. This separation makes specs
portable, serializable, and reusable across datasets and studies.</p>
<p>This vignette covers the key differences with side-by-side
examples.</p>
</div>
<div class="section level2">
<h2 id="quick-reference-function-mapping">Quick Reference: Function Mapping<a class="anchor" aria-label="anchor" href="#quick-reference-function-mapping"></a>
</h2>
<p>The table below maps v1 functions to their tplyr2 equivalents.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Tplyr v1</th>
<th>tplyr2</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>tplyr_table(data, treat_var)</code></td>
<td><code>tplyr_spec(cols = "treat_var")</code></td>
<td>Data at build time, not in the spec</td>
</tr>
<tr class="even">
<td><code>add_layer()</code></td>
<td>
<code><a href="../reference/tplyr_layers.html">tplyr_layers()</a></code> inside <code><a href="../reference/tplyr_spec.html">tplyr_spec()</a></code>
</td>
<td>Declarative layer collection</td>
</tr>
<tr class="odd">
<td><code>group_count(target_var)</code></td>
<td><code>group_count("target_var")</code></td>
<td>Variable names are quoted strings</td>
</tr>
<tr class="even">
<td><code>group_desc(target_var)</code></td>
<td><code>group_desc("target_var")</code></td>
<td>Variable names are quoted strings</td>
</tr>
<tr class="odd">
<td><code>group_shift(vars)</code></td>
<td><code>group_shift(c(row = "v1", column = "v2"))</code></td>
<td>Named character vector</td>
</tr>
<tr class="even">
<td><code>set_format_strings()</code></td>
<td>
<code>format_strings</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>
</td>
<td>Nested in settings object</td>
</tr>
<tr class="odd">
<td><code>set_distinct_by()</code></td>
<td>
<code>distinct_by</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>
</td>
<td>Character string</td>
</tr>
<tr class="even">
<td><code>set_denoms_by()</code></td>
<td>
<code>denoms_by</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>
</td>
<td>Character vector</td>
</tr>
<tr class="odd">
<td><code>set_where()</code></td>
<td>
<code>where</code> parameter in layer or spec</td>
<td>Bare expression (unquoted)</td>
</tr>
<tr class="even">
<td><code>add_total_group()</code></td>
<td>
<code><a href="../reference/total_group.html">total_group()</a></code> in spec’s <code>total_groups</code>
</td>
<td>Spec-level config</td>
</tr>
<tr class="odd">
<td><code>set_pop_data()</code></td>
<td>
<code><a href="../reference/pop_data.html">pop_data()</a></code> in spec + <code><a href="../reference/tplyr_build.html">tplyr_build()</a></code>
</td>
<td>Config in spec, data at build</td>
</tr>
<tr class="even">
<td><code>build()</code></td>
<td><code>tplyr_build(spec, data)</code></td>
<td>Data supplied at build time</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/f_str.html">f_str()</a></code></td>
<td><code><a href="../reference/f_str.html">f_str()</a></code></td>
<td>Variable names are now quoted strings</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="key-differences-in-detail">Key Differences in Detail<a class="anchor" aria-label="anchor" href="#key-differences-in-detail"></a>
</h2>
<div class="section level3">
<h3 id="data-is-separated-from-configuration">Data Is Separated from Configuration<a class="anchor" aria-label="anchor" href="#data-is-separated-from-configuration"></a>
</h3>
<p>In v1, data lives inside the table object from the moment you create
it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tplyr v1: data bound at table creation</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">tplyr_table</span><span class="op">(</span><span class="va">adsl</span>, <span class="va">TRT01P</span><span class="op">)</span></span></code></pre></div>
<p>In tplyr2, the spec knows nothing about data. You supply data only
when you are ready to build:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data provided at build time</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span></code></pre></div>
<p>This means the same spec can be applied to different datasets without
modifying the spec itself.</p>
</div>
<div class="section level3">
<h3 id="variable-names-are-quoted-strings">Variable Names Are Quoted Strings<a class="anchor" aria-label="anchor" href="#variable-names-are-quoted-strings"></a>
</h3>
<p>In v1, variable names are bare symbols. In tplyr2, they are character
strings. This is required for JSON/YAML serialization and simpler
programmatic construction. The one exception is <code>where</code>,
which accepts bare expressions:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Tplyr v1: bare symbols              # tplyr2: quoted strings</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">group_count</span>(SEX)                       <span class="fu">group_count</span>(<span class="st">"SEX"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">group_desc</span>(AGE)                        <span class="fu">group_desc</span>(<span class="st">"AGE"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span>, where <span class="op">=</span> <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="settings-are-collected-in-an-object">Settings Are Collected in an Object<a class="anchor" aria-label="anchor" href="#settings-are-collected-in-an-object"></a>
</h3>
<p>In v1, you configure layers by piping modifier functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tplyr v1: piped modifiers</span></span>
<span><span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="va">RACE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_format_strings</span><span class="op">(</span><span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="va">n</span>, <span class="va">pct</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_distinct_by</span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">set_denoms_by</span><span class="op">(</span><span class="va">TRT01P</span><span class="op">)</span></span></code></pre></div>
<p>In tplyr2, all configuration lives in a single
<code><a href="../reference/layer_settings.html">layer_settings()</a></code> object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tplyr2: declarative settings</span></span>
<span><span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"RACE"</span>,</span>
<span>  settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>    format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    denoms_by <span class="op">=</span> <span class="st">"TRT01P"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="format-strings-use-quoted-variable-names">Format Strings Use Quoted Variable Names<a class="anchor" aria-label="anchor" href="#format-strings-use-quoted-variable-names"></a>
</h3>
<p>The <code><a href="../reference/f_str.html">f_str()</a></code> function works the same way, but variable
names are now strings. For desc layers, format strings are a named list
(each name becomes a row label). For count layers, the list key is
<code>n_counts</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># v1: bare symbols                     # tplyr2: quoted strings</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">f_str</span>(<span class="st">"xx (xx.x%)"</span>, n, pct)            <span class="fu">f_str</span>(<span class="st">"xx (xx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Desc layer: named list of format strings</span></span>
<span><span class="va">format_strings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>  <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Count layer: key is n_counts</span></span>
<span><span class="va">format_strings</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="side-by-side-examples">Side-by-Side Examples<a class="anchor" aria-label="anchor" href="#side-by-side-examples"></a>
</h2>
<div class="section level3">
<h3 id="demographics-table">Demographics Table<a class="anchor" aria-label="anchor" href="#demographics-table"></a>
</h3>
<div class="section level4">
<h4 id="tplyr-v1">Tplyr v1<a class="anchor" aria-label="anchor" href="#tplyr-v1"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tplyr v1 approach (not evaluated)</span></span>
<span><span class="fu">tplyr_table</span><span class="op">(</span><span class="va">adsl</span>, <span class="va">TRT01P</span>, where <span class="op">=</span> <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_layer</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="va">SEX</span>, by <span class="op">=</span> <span class="st">"Sex n (%)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_layer</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="va">AGE</span>, by <span class="op">=</span> <span class="st">"Age (Years)"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">set_format_strings</span><span class="op">(</span></span>
<span>        <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx"</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>        <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span>,</span>
<span>        <span class="st">"Median"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x"</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>        <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx, xx"</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">build</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tplyr2">tplyr2<a class="anchor" aria-label="anchor" href="#tplyr2"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  where <span class="op">=</span> <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span>, by <span class="op">=</span> <span class="st">"Sex n (%)"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"Age (Years)"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx, xx"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Sex n (%)</td>
<td align="left">F</td>
<td align="left">53 (61.6%)</td>
<td align="left">40 (47.6%)</td>
<td align="left">50 (59.5%)</td>
</tr>
<tr class="even">
<td align="left">Sex n (%)</td>
<td align="left">M</td>
<td align="left">33 (38.4%)</td>
<td align="left">44 (52.4%)</td>
<td align="left">34 (40.5%)</td>
</tr>
<tr class="odd">
<td align="left">Age (Years)</td>
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
</tr>
<tr class="even">
<td align="left">Age (Years)</td>
<td align="left">Mean (SD)</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
</tr>
<tr class="odd">
<td align="left">Age (Years)</td>
<td align="left">Median</td>
<td align="left">76.0</td>
<td align="left">76.0</td>
<td align="left">77.5</td>
</tr>
<tr class="even">
<td align="left">Age (Years)</td>
<td align="left">Min, Max</td>
<td align="left">52, 89</td>
<td align="left">56, 88</td>
<td align="left">51, 88</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="adverse-events-table-nested-counts">Adverse Events Table (Nested Counts)<a class="anchor" aria-label="anchor" href="#adverse-events-table-nested-counts"></a>
</h3>
<div class="section level4">
<h4 id="tplyr-v1-1">Tplyr v1<a class="anchor" aria-label="anchor" href="#tplyr-v1-1"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tplyr v1 approach (not evaluated)</span></span>
<span><span class="fu">tplyr_table</span><span class="op">(</span><span class="va">adae</span>, <span class="va">TRTA</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_layer</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">AEBODSYS</span>, <span class="va">AEDECOD</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">set_distinct_by</span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">set_format_strings</span><span class="op">(</span><span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="va">distinct_n</span>, <span class="va">distinct_pct</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">set_order_count_method</span><span class="op">(</span><span class="st">"bycount"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">set_ordering_cols</span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">build</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tplyr2-1">tplyr2<a class="anchor" aria-label="anchor" href="#tplyr2-1"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        order_count_method <span class="op">=</span> <span class="st">"bycount"</span>,</span>
<span>        ordering_cols <span class="op">=</span> <span class="st">"Xanomeline High Dose"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="41%">
<col width="29%">
<col width="9%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">2 ( 4.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">TACHYCARDIA</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left"></td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left">VENTRICULAR SEPTAL DEFECT</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">GASTROINTESTINAL DISORDERS</td>
<td align="left"></td>
<td align="left">6 (18.8%)</td>
<td align="left">4 ( 9.3%)</td>
<td align="left">3 ( 6.0%)</td>
</tr>
</tbody>
</table>
<p>Note how <code>vars(AEBODSYS, AEDECOD)</code> becomes
<code>c("AEBODSYS", "AEDECOD")</code>, piped modifiers become arguments
in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>, and data is supplied at build.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="new-features-in-tplyr2">New Features in tplyr2<a class="anchor" aria-label="anchor" href="#new-features-in-tplyr2"></a>
</h2>
<p>Beyond the API redesign, tplyr2 introduces several entirely new
capabilities.</p>
<div class="section level3">
<h3 id="spec-serialization">Spec Serialization<a class="anchor" aria-label="anchor" href="#spec-serialization"></a>
</h3>
<p>Specs can be saved to disk as JSON or YAML and loaded later, enabling
centralized spec authoring with distributed execution:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tplyr_write_spec.html">tplyr_write_spec</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="va">spec_loaded</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_read_spec.html">tplyr_read_spec</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="va">spec_loaded</span></span>
<span><span class="co">#&gt; tplyr2 table specification</span></span>
<span><span class="co">#&gt; Column variables: TRT01PLayers: 2[1] count: SEX (Layer 1)[2] desc: AGE (Layer 2)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-analysis-layers">Custom Analysis Layers<a class="anchor" aria-label="anchor" href="#custom-analysis-layers"></a>
</h3>
<p><code><a href="../reference/group_analyze.html">group_analyze()</a></code> accepts a user-defined function for
arbitrary computations. The function receives each group’s data subset
and returns a data.frame of numeric results:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span>, <span class="va">.target_var</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vals</span> <span class="op">&lt;-</span> <span class="va">.data</span><span class="op">[[</span><span class="va">.target_var</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    geo_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">vals</span><span class="op">[</span><span class="va">vals</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    geo_sd   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">vals</span><span class="op">[</span><span class="va">vals</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_analyze.html">group_analyze</a></span><span class="op">(</span><span class="st">"AGE"</span>, analyze_fn <span class="op">=</span> <span class="va">custom_fn</span>, settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>      format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Geometric Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.xx (xx.xx)"</span>, <span class="st">"geo_mean"</span>, <span class="st">"geo_sd"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Geometric Mean (SD)</td>
<td align="left">74.70 ( 1.13)</td>
<td align="left">73.94 ( 1.12)</td>
<td align="left">75.18 ( 1.12)</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="cell-level-metadata">Cell-Level Metadata<a class="anchor" aria-label="anchor" href="#cell-level-metadata"></a>
</h3>
<p>When <code>metadata = TRUE</code> is passed to
<code><a href="../reference/tplyr_build.html">tplyr_build()</a></code>, every cell carries metadata tracing back to
source data rows for auditability:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span><span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span>, metadata <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">row_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_row_ids.html">generate_row_ids</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Inspect the metadata for one cell, then retrieve its source rows</span></span>
<span><span class="fu"><a href="../reference/tplyr_meta_result.html">tplyr_meta_result</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">row_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"res1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; tplyr_meta [layer 1]</span></span>
<span><span class="co">#&gt;   Names: TRT01P, SEX</span></span>
<span><span class="co">#&gt;   Filters:</span></span>
<span><span class="co">#&gt;     TRT01P == "Placebo"</span></span>
<span><span class="co">#&gt;     SEX == "F"</span></span>
<span><span class="va">source_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_meta_subset.html">tplyr_meta_subset</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">row_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"res1"</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">source_rows</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>, <span class="st">"SEX"</span>, <span class="st">"TRT01P"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">USUBJID</th>
<th align="left">SEX</th>
<th align="left">TRT01P</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01-701-1015</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
<tr class="even">
<td align="left">01-701-1047</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
<tr class="odd">
<td align="left">01-701-1153</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
<tr class="even">
<td align="left">01-701-1203</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
<tr class="odd">
<td align="left">01-701-1345</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
<tr class="even">
<td align="left">01-701-1363</td>
<td align="left">F</td>
<td align="left">Placebo</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="ard-conversion-and-numeric-data">ARD Conversion and Numeric Data<a class="anchor" aria-label="anchor" href="#ard-conversion-and-numeric-data"></a>
</h3>
<p><code><a href="../reference/tplyr_to_ard.html">tplyr_to_ard()</a></code> converts results into long-format
Analysis Results Data. <code><a href="../reference/tplyr_numeric_data.html">tplyr_numeric_data()</a></code> provides raw
unformatted numbers for validation:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span><span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"SEX"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/tplyr_to_ard.html">tplyr_to_ard</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">analysis_id</th>
<th align="left">TRT01P</th>
<th align="left">SEX</th>
<th align="left">stat_name</th>
<th align="right">stat_value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Placebo</td>
<td align="left">F</td>
<td align="left">n</td>
<td align="right">53.00000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Placebo</td>
<td align="left">M</td>
<td align="left">n</td>
<td align="right">33.00000</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">F</td>
<td align="left">n</td>
<td align="right">40.00000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">M</td>
<td align="left">n</td>
<td align="right">44.00000</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Xanomeline Low Dose</td>
<td align="left">F</td>
<td align="left">n</td>
<td align="right">50.00000</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Xanomeline Low Dose</td>
<td align="left">M</td>
<td align="left">n</td>
<td align="right">34.00000</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Placebo</td>
<td align="left">F</td>
<td align="left">pct</td>
<td align="right">61.62791</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Placebo</td>
<td align="left">M</td>
<td align="left">pct</td>
<td align="right">38.37209</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">F</td>
<td align="left">pct</td>
<td align="right">47.61905</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Xanomeline High Dose</td>
<td align="left">M</td>
<td align="left">pct</td>
<td align="right">52.38095</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/tplyr_numeric_data.html">tplyr_numeric_data</a></span><span class="op">(</span><span class="va">result</span>, layer <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">TRT01P</th>
<th align="left">SEX</th>
<th align="right">n</th>
<th align="right">pct</th>
<th align="right">total</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Placebo</td>
<td align="left">F</td>
<td align="right">53</td>
<td align="right">61.62791</td>
<td align="right">86</td>
</tr>
<tr class="even">
<td align="left">Placebo</td>
<td align="left">M</td>
<td align="right">33</td>
<td align="right">38.37209</td>
<td align="right">86</td>
</tr>
<tr class="odd">
<td align="left">Xanomeline High Dose</td>
<td align="left">F</td>
<td align="right">40</td>
<td align="right">47.61905</td>
<td align="right">84</td>
</tr>
<tr class="even">
<td align="left">Xanomeline High Dose</td>
<td align="left">M</td>
<td align="right">44</td>
<td align="right">52.38095</td>
<td align="right">84</td>
</tr>
<tr class="odd">
<td align="left">Xanomeline Low Dose</td>
<td align="left">F</td>
<td align="right">50</td>
<td align="right">59.52381</td>
<td align="right">84</td>
</tr>
<tr class="even">
<td align="left">Xanomeline Low Dose</td>
<td align="left">M</td>
<td align="right">34</td>
<td align="right">40.47619</td>
<td align="right">84</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The migration from Tplyr v1 to tplyr2 involves three main shifts:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Declare, don’t pipe.</strong> Replace
<code>tplyr_table() %&gt;% add_layer() %&gt;% build()</code> with
<code><a href="../reference/tplyr_spec.html">tplyr_spec()</a></code> +
<code>tplyr_build(spec, data)</code>.</p></li>
<li><p><strong>Quote your variable names.</strong> Bare symbols like
<code>AGE</code> become <code>"AGE"</code>. The <code>where</code>
parameter is the only place bare expressions are still used.</p></li>
<li><p><strong>Collect settings in one place.</strong> Instead of piping
<code>set_*()</code> calls, pass a <code><a href="../reference/layer_settings.html">layer_settings()</a></code> object
to the <code>settings</code> parameter of each layer.</p></li>
</ol>
<p>The output structure – <code>rowlabel</code> columns,
<code>res</code> columns with label attributes, and <code>ord</code>
columns for sorting – remains the same. Existing downstream code that
consumes tplyr output should work with minimal changes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
