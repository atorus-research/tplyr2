<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>General String Formatting • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="General String Formatting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>General String Formatting</h1>
            
      

      <div class="d-none name"><code>general_string_formatting.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Clinical tables live and die by their alignment. When a reviewer
scans a column of numbers, the decimal points must line up, the
parentheses must sit in the same position from row to row, and the
whitespace must be consistent. One misaligned digit and the table looks
unprofessional – or worse, it raises questions about the numbers
themselves.</p>
<p>tplyr2 solves this with <strong>format strings</strong>: a compact
notation that describes exactly how wide each number field should be,
where decimals fall, and how padding works. The <code><a href="../reference/f_str.html">f_str()</a></code>
function is the entry point. You give it a template string and the names
of the statistics that fill each slot, and tplyr2 takes care of the
rest.</p>
</div>
<div class="section level2">
<h2 id="how-format-strings-work">How Format Strings Work<a class="anchor" aria-label="anchor" href="#how-format-strings-work"></a>
</h2>
<p>A format string is a character template containing one or more
<strong>format groups</strong> separated by <strong>literal
text</strong>. Each format group corresponds to one statistic.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two format groups separated by the literal " ("  and closing ")"</span></span>
<span><span class="va">fmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span><span class="va">fmt</span></span>
<span><span class="co">#&gt; tplyr format string: "xx.x (xx.xx)"Variables: mean, sd</span></span></code></pre></div>
<p>In this example:</p>
<ul>
<li>
<code>xx.x</code> is the first format group (for <code>mean</code>):
two integer digits, one decimal digit.</li>
<li>
<code>(</code> is a literal separator between the first and second
groups.</li>
<li>
<code>xx.xx</code> is the second format group (for <code>sd</code>):
two integer digits, two decimal digits.</li>
<li>
<code>)</code> is a trailing literal.</li>
</ul>
<p>The number of <code>x</code> characters determines the field width.
Each <code>x</code> reserves exactly one character position in the
output, so numbers narrower than the field are left-padded with spaces
to maintain alignment across rows.</p>
</div>
<div class="section level2">
<h2 id="available-variables-by-layer-type">Available Variables by Layer Type<a class="anchor" aria-label="anchor" href="#available-variables-by-layer-type"></a>
</h2>
<p>Each layer type computes a specific set of statistics that you can
reference in format strings.</p>
<table class="table">
<colgroup>
<col width="34%">
<col width="28%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th align="left">Layer Type</th>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Count</td>
<td align="left"><code>n</code></td>
<td align="left">Number of observations</td>
</tr>
<tr class="even">
<td align="left">Count</td>
<td align="left"><code>pct</code></td>
<td align="left">Percentage of observations</td>
</tr>
<tr class="odd">
<td align="left">Count</td>
<td align="left"><code>total</code></td>
<td align="left">Denominator for percentage</td>
</tr>
<tr class="even">
<td align="left">Count</td>
<td align="left"><code>distinct_n</code></td>
<td align="left">Number of distinct subjects (requires
<code>distinct_by</code>)</td>
</tr>
<tr class="odd">
<td align="left">Count</td>
<td align="left"><code>distinct_pct</code></td>
<td align="left">Percentage of distinct subjects</td>
</tr>
<tr class="even">
<td align="left">Count</td>
<td align="left"><code>distinct_total</code></td>
<td align="left">Distinct denominator</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>n</code></td>
<td align="left">Non-missing observation count</td>
</tr>
<tr class="even">
<td align="left">Desc</td>
<td align="left"><code>mean</code></td>
<td align="left">Arithmetic mean</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>sd</code></td>
<td align="left">Standard deviation</td>
</tr>
<tr class="even">
<td align="left">Desc</td>
<td align="left"><code>median</code></td>
<td align="left">Median</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>var</code></td>
<td align="left">Variance</td>
</tr>
<tr class="even">
<td align="left">Desc</td>
<td align="left"><code>min</code></td>
<td align="left">Minimum</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>max</code></td>
<td align="left">Maximum</td>
</tr>
<tr class="even">
<td align="left">Desc</td>
<td align="left"><code>iqr</code></td>
<td align="left">Interquartile range</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>q1</code></td>
<td align="left">First quartile</td>
</tr>
<tr class="even">
<td align="left">Desc</td>
<td align="left"><code>q3</code></td>
<td align="left">Third quartile</td>
</tr>
<tr class="odd">
<td align="left">Desc</td>
<td align="left"><code>missing</code></td>
<td align="left">Count of missing values</td>
</tr>
<tr class="even">
<td align="left">Shift</td>
<td align="left"><code>n</code></td>
<td align="left">Number of observations</td>
</tr>
<tr class="odd">
<td align="left">Shift</td>
<td align="left"><code>pct</code></td>
<td align="left">Percentage of observations</td>
</tr>
<tr class="even">
<td align="left">Shift</td>
<td align="left"><code>total</code></td>
<td align="left">Denominator for percentage</td>
</tr>
<tr class="odd">
<td align="left">Analyze</td>
<td align="left"><em>(user-defined)</em></td>
<td align="left">Names returned by <code>analyze_fn</code>
</td>
</tr>
</tbody>
</table>
<p>For count layers, format strings are provided as a named list with
the key <code>n_counts</code>. For descriptive statistics layers, each
named entry in the <code>format_strings</code> list becomes a separate
output row, with the name used as the row label.</p>
</div>
<div class="section level2">
<h2 id="lowercase-x-fixed-width-fields">Lowercase x: Fixed-Width Fields<a class="anchor" aria-label="anchor" href="#lowercase-x-fixed-width-fields"></a>
</h2>
<p>The <code>x</code> character is the workhorse of format strings. Each
<code>x</code> reserves one character position. If a number has fewer
digits than the number of <code>x</code> characters, the output is
left-padded with spaces. If a number has more digits than available
positions, the number prints in full (it is never truncated).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>          <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>     <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Q1, Q3"</span>     <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x, xx.x"</span>, <span class="st">"q1"</span>, <span class="st">"q3"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>   <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx, xx"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Mean (SD)</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Median</td>
<td align="left">76.0</td>
<td align="left">76.0</td>
<td align="left">77.5</td>
</tr>
<tr class="even">
<td align="left">Age (years)</td>
<td align="left">Q1, Q3</td>
<td align="left">69.2, 81.8</td>
<td align="left">70.8, 80.0</td>
<td align="left">71.0, 82.0</td>
</tr>
<tr class="odd">
<td align="left">Age (years)</td>
<td align="left">Min, Max</td>
<td align="left">52, 89</td>
<td align="left">56, 88</td>
<td align="left">51, 88</td>
</tr>
</tbody>
</table>
<p>Notice how the numbers align within each column. The
<code>xx.x</code> format for <code>mean</code> creates a field three
characters wide before the decimal and one after, so a mean of
<code>75.2</code> prints as <code>75.2</code> while a mean of
<code>8.3</code> would print as <code>8.3</code> (with a leading space).
This consistent field width is what makes clinical tables scannable.</p>
</div>
<div class="section level2">
<h2 id="uppercase-x-parenthesis-hugging">Uppercase X: Parenthesis Hugging<a class="anchor" aria-label="anchor" href="#uppercase-x-parenthesis-hugging"></a>
</h2>
<p>Standard <code>x</code> formatting pads numbers inside their
surrounding delimiters. This means a parenthesis or bracket can end up
separated from the number it encloses by one or more spaces, which can
look awkward:</p>
<pre><code> 14 ( 16.3%)
  7 (  8.1%)</code></pre>
<p>Uppercase <code>X</code> solves this with <strong>parenthesis
hugging</strong>. When a format group uses <code>X</code> characters,
any leading spaces that would normally appear inside the number field
are shifted <em>outside</em> the preceding delimiter. The result is that
the opening parenthesis (or bracket) always sits immediately next to the
first significant digit.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standard formatting: spaces inside parentheses</span></span>
<span><span class="va">spec_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xxx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec_standard</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parenthesis hugging: spaces shift outside the delimiter</span></span>
<span><span class="va">spec_hugged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (XXX.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_hugged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec_hugged</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span></code></pre></div>
<p>Here is the standard formatting, where padding sits between the
parenthesis and the number:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_standard</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">40 ( 47.6%)</td>
<td align="left">44 ( 52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 ( 67.4%)</td>
<td align="left">27 ( 32.1%)</td>
<td align="left">25 ( 29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
</tbody>
</table>
<p>And here is the same data with parenthesis hugging applied to the
percentage group. The opening parenthesis now hugs the number, and the
displaced spaces move to the left of the parenthesis:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_hugged</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 (9.3% )</td>
<td align="left">40 (47.6% )</td>
<td align="left">44 (52.4% )</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (67.4% )</td>
<td align="left">27 (32.1% )</td>
<td align="left">25 (29.8% )</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 (2.3% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (1.2% )</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 (3.5% )</td>
<td align="left">1 (1.2% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 (1.2% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (1.2% )</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 (1.2% )</td>
<td align="left">2 (2.4% )</td>
<td align="left">0 (0.0% )</td>
</tr>
</tbody>
</table>
<p>The total string width stays the same – the spaces do not disappear,
they just relocate. This preserves column alignment while giving the
output a cleaner look.</p>
<p>Parenthesis hugging works with any delimiter that appears as a
literal in the format string, including square brackets <code>[</code>
and other characters.</p>
</div>
<div class="section level2">
<h2 id="auto-precision-with-a-and-a">Auto-Precision with a and A<a class="anchor" aria-label="anchor" href="#auto-precision-with-a-and-a"></a>
</h2>
<p>In descriptive statistics tables, the appropriate number of decimal
places often depends on the data itself. A lab parameter measured to one
decimal place should be summarized with one or two decimal digits, while
one measured to three decimal places needs more. Hardcoding widths for
every parameter is tedious and error-prone.</p>
<p>The <code>a</code> and <code>A</code> characters enable
<strong>auto-precision</strong>: the field width is determined at build
time from the actual data. Specifically, tplyr2 scans the target
variable, finds the maximum number of decimal places present, and uses
that as the base precision.</p>
<ul>
<li>
<code>a</code> – auto-precision digit (like <code>x</code>, but
width comes from data)</li>
<li>
<code>A</code> – auto-precision with parenthesis hugging (like
<code>X</code>, but width comes from data)</li>
<li>
<code>+N</code> suffix – adds N to the auto-determined width (e.g.,
<code>a+1</code> means data precision plus one extra decimal place)</li>
</ul>
<p>Auto-precision is controlled by three settings in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>:</p>
<ul>
<li>
<code>precision_by</code>: character vector of grouping variables
(precision computed per group)</li>
<li>
<code>precision_on</code>: character name of the variable to scan
for precision (defaults to target variable)</li>
<li>
<code>precision_cap</code>: named numeric vector
<code>c(int = , dec = )</code> to cap the maximum widths</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AVAL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"Urate (umol/L)"</span>,</span>
<span>      where <span class="op">=</span> <span class="va">AVISIT</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Baseline"</span>, <span class="st">"Week 12"</span>, <span class="st">"Week 24"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        precision_on <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>          <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a+1.a+1 (a+2.a+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Median"</span>     <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a+1.a+1"</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Q1, Q3"</span>     <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a+1.a+1, a+1.a+1"</span>, <span class="st">"q1"</span>, <span class="st">"q3"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Min, Max"</span>   <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a.a, a.a"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adlb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="15%">
<col width="10%">
<col width="24%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Urate (umol/L)</td>
<td align="left">n</td>
<td align="left">20</td>
<td align="left">21</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">Urate (umol/L)</td>
<td align="left">Mean (SD)</td>
<td align="left">324.7608 ( 74.75026)</td>
<td align="left">298.8162 ( 50.36185)</td>
<td align="left">282.2596 ( 77.20328)</td>
</tr>
<tr class="odd">
<td align="left">Urate (umol/L)</td>
<td align="left">Median</td>
<td align="left">306.3220</td>
<td align="left">297.4000</td>
<td align="left">273.6080</td>
</tr>
<tr class="even">
<td align="left">Urate (umol/L)</td>
<td align="left">Q1, Q3</td>
<td align="left">266.1730, 394.0550</td>
<td align="left">273.6080, 315.2440</td>
<td align="left">240.8940, 297.4000</td>
</tr>
<tr class="odd">
<td align="left">Urate (umol/L)</td>
<td align="left">Min, Max</td>
<td align="left">226.024, 469.892</td>
<td align="left">231.972, 469.892</td>
<td align="left">178.440, 428.256</td>
</tr>
</tbody>
</table>
<p>In this example, <code>precision_on = "AVAL"</code> tells tplyr2 to
scan the <code>AVAL</code> column to determine the number of decimal
places present in the data. The <code>+1</code> and <code>+2</code>
suffixes add one and two extra decimal places beyond what the data
contains. For <code>Min, Max</code>, <code>a.a</code> uses the raw data
precision with no extra digits.</p>
<p>When <code>precision_by</code> is also set, precision is computed
separately for each group – useful when a single spec covers multiple
lab parameters, each measured at a different scale. This means you can
write one spec that handles dozens of parameters, each rendered at the
precision appropriate to its measurement.</p>
<p>Note that auto-precision characters can also be used in count layers.
For instance, <code>a</code> in the integer portion of a count format
will auto-size the field width based on the data, so you do not have to
guess how many digits the largest count will require.</p>
</div>
<div class="section level2">
<h2 id="the-empty-argument">The empty Argument<a class="anchor" aria-label="anchor" href="#the-empty-argument"></a>
</h2>
<p>When a statistic is <code>NA</code> (for example, standard deviation
when <code>n = 1</code>), format strings produce blank space by default
to preserve alignment. You can override this with the <code>empty</code>
argument to <code><a href="../reference/f_str.html">f_str()</a></code>, which specifies a replacement string
when all values in a format group are missing.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fmt_with_empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span></span>
<span>  <span class="st">"xx.x (xx.xx)"</span>,</span>
<span>  <span class="st">"mean"</span>, <span class="st">"sd"</span>,</span>
<span>  empty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>.overall <span class="op">=</span> <span class="st">"   -"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fmt_with_empty</span></span>
<span><span class="co">#&gt; tplyr format string: "xx.x (xx.xx)"Variables: mean, sdEmpty: c(.overall = "   -")</span></span></code></pre></div>
<p>The <code>.overall</code> key means the replacement applies when
<em>all</em> statistics in the string are <code>NA</code>. This is
useful for displaying a dash or other placeholder in rows where a
summary cannot be computed.</p>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting It All Together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>Let us build a more complete example: an adverse event summary that
combines parenthesis hugging with fixed-width fields, similar to what
you would see in a clinical study report.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (XXX.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="va">collapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_row_labels.html">collapse_row_labels</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, indent <span class="op">=</span> <span class="st">"   "</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">collapsed</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row_label"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="56%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">row_label</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">4 (12.5% )</td>
<td align="left">6 (14.0% )</td>
<td align="left">5 (10.0% )</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.0% )</td>
</tr>
<tr class="even">
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.3% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 (3.1% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="even">
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 (3.1% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 (3.1% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="even">
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.3% )</td>
<td align="left">2 (4.0% )</td>
</tr>
<tr class="odd">
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 (0.0% )</td>
<td align="left">3 (7.0% )</td>
<td align="left">1 (2.0% )</td>
</tr>
<tr class="even">
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 (3.1% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.0% )</td>
</tr>
<tr class="odd">
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.0% )</td>
</tr>
<tr class="even">
<td align="left">TACHYCARDIA</td>
<td align="left">1 (3.1% )</td>
<td align="left">0 (0.0% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="odd">
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.3% )</td>
<td align="left">0 (0.0% )</td>
</tr>
<tr class="even">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">0 (0.0% )</td>
<td align="left">1 (2.3% )</td>
<td align="left">0 (0.0% )</td>
</tr>
</tbody>
</table>
<p>In this table:</p>
<ul>
<li>
<code>xxx</code> gives a three-digit fixed field for distinct
subject counts.</li>
<li>
<code>XXX.x</code> uses parenthesis hugging so the <code>(</code>
sits right next to the percentage value.</li>
<li>The <code>%</code> sign is literal text that appears after the
percentage in every cell.</li>
<li>
<code>distinct_n</code> and <code>distinct_pct</code> compute
subject-level (not event-level) summaries.</li>
<li>Nested counts display body system totals alongside preferred term
detail.</li>
</ul>
<p>The format string system in tplyr2 is designed so that you declare
the <em>shape</em> of each number field once, and the package handles
padding, alignment, and precision across every cell in the table.
Whether you need fixed widths, data-driven precision, or
delimiter-hugging alignment, the same <code><a href="../reference/f_str.html">f_str()</a></code> interface
covers all three.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
