<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>tplyr2 Options • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="tplyr2 Options">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>tplyr2 Options</h1>
            
      

      <div class="d-none name"><code>options.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>tplyr2 provides a set of session-level options that control how
tables are built. These options let you configure behaviors that apply
across all tables in a session – rounding rules, quantile algorithms,
precision limits, custom summary functions, and scientific notation
handling – without repeating yourself in every spec.</p>
<p>All tplyr2 options are managed through a single function:
<code><a href="../reference/tplyr2_options.html">tplyr2_options()</a></code>. When called with no arguments, it returns
the current values of all options. When called with named arguments, it
sets those options. Under the hood, each option is stored as a standard
R option with the <code>tplyr2.</code> prefix, so they can also be set
with <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> directly if you prefer.</p>
</div>
<div class="section level2">
<h2 id="viewing-current-options">Viewing Current Options<a class="anchor" aria-label="anchor" href="#viewing-current-options"></a>
</h2>
<p>To see what every option is currently set to, call
<code><a href="../reference/tplyr2_options.html">tplyr2_options()</a></code> with no arguments:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $tplyr2.IBMRounding</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.quantile_type</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.precision_cap</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.custom_summaries</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.scipen</span></span>
<span><span class="co">#&gt; [1] 9999</span></span></code></pre></div>
<p>The output is a named list. Options you have not changed show their
defaults: <code>IBMRounding</code> is <code>FALSE</code>,
<code>quantile_type</code> is <code>7</code>, <code>precision_cap</code>
and <code>custom_summaries</code> are <code>NULL</code>, and
<code>scipen</code> is <code>9999</code>.</p>
</div>
<div class="section level2">
<h2 id="ibm-rounding">IBM Rounding<a class="anchor" aria-label="anchor" href="#ibm-rounding"></a>
</h2>
<p>R uses “banker’s rounding” (round half to even) by default. This
means that 0.5 rounds to 0, 1.5 rounds to 2, 2.5 rounds to 2, and 3.5
rounds to 4. The rule minimizes cumulative bias in large datasets, but
it does not match how SAS and many other statistical software packages
round.</p>
<p>In clinical trial reporting, you often need to reproduce SAS output
exactly. SAS uses round-half-away-from-zero (sometimes called “IBM
rounding”), where 2.5 always rounds up to 3 and -2.5 always rounds down
to -3. tplyr2 supports this through the <code>IBMRounding</code>
option.</p>
<p>The formula used when IBM rounding is enabled is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">round</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mtext mathvariant="normal">sign</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">⌊</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>x</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>⋅</mo><msup><mn>10</mn><mi>d</mi></msup><mo>+</mo><mn>0.5</mn><mo stretchy="true" form="postfix">⌋</mo></mrow><mi>/</mi><msup><mn>10</mn><mi>d</mi></msup></mrow><annotation encoding="application/x-tex">\text{round}(x) = \text{sign}(x) \cdot \left\lfloor |x| \cdot 10^d + 0.5 \right\rfloor / 10^d</annotation></semantics></math></p>
<p>Let’s see the difference in practice. We will build a simple
descriptive statistics table and compare the mean under both rounding
methods.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data where rounding makes a visible difference</span></span>
<span><span class="va">demo_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  TRT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Drug"</span>, <span class="st">"Placebo"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  VAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"VAL"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Mean"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"x.x"</span>, <span class="st">"mean"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default: banker's rounding</span></span>
<span><span class="va">result_bankers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">demo_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_bankers</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_bankers</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Banker's rounding (default)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Banker’s rounding (default)</caption>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Mean</td>
<td align="left">4.0</td>
<td align="left">3.0</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># IBM rounding</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>IBMRounding <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_ibm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">demo_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_ibm</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_ibm</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"IBM rounding (round-half-away-from-zero)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>IBM rounding (round-half-away-from-zero)</caption>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Mean</td>
<td align="left">4.0</td>
<td align="left">3.0</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Reset to default</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>IBMRounding <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The difference is subtle but consequential for regulatory
submissions. When the mean falls exactly on a rounding boundary (e.g.,
4.0 with one decimal rounds to “4.0” either way, but values like 2.25
rounded to one decimal show the difference), IBM rounding consistently
rounds the 5 away from zero, while banker’s rounding alternates based on
the preceding digit.</p>
</div>
<div class="section level2">
<h2 id="quantile-algorithm">Quantile Algorithm<a class="anchor" aria-label="anchor" href="#quantile-algorithm"></a>
</h2>
<p>R’s <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code> function supports nine different
algorithms, numbered Type 1 through Type 9. The default in R is Type 7,
which uses linear interpolation and is widely used in statistics.
However, SAS’s <code>PROC UNIVARIATE</code> uses an algorithm closest to
R’s Type 3, which selects the nearest even order statistic.</p>
<p>In tplyr2, the <code>quantile_type</code> option controls which
algorithm is used for <code>q1</code>, <code>q3</code>, and
<code>iqr</code> in descriptive statistics layers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Q1, Q3"</span>  <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.xx, xx.xx"</span>, <span class="st">"q1"</span>, <span class="st">"q3"</span><span class="op">)</span>,</span>
<span>          <span class="st">"IQR"</span>     <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.xx"</span>, <span class="st">"iqr"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Type 7 (R default)</span></span>
<span><span class="va">result_t7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_t7</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_t7</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Quantile Type 7 (R default)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Quantile Type 7 (R default)</caption>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">69.25, 81.75</td>
<td align="left">70.75, 80.00</td>
<td align="left">71.00, 82.00</td>
</tr>
<tr class="even">
<td align="left">IQR</td>
<td align="left">12.50</td>
<td align="left">9.25</td>
<td align="left">11.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Type 3 (SAS-compatible)</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>quantile_type <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_t3</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_t3</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Quantile Type 3 (SAS-compatible)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Quantile Type 3 (SAS-compatible)</caption>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Q1, Q3</td>
<td align="left">69.00, 81.00</td>
<td align="left">70.00, 80.00</td>
<td align="left">71.00, 82.00</td>
</tr>
<tr class="even">
<td align="left">IQR</td>
<td align="left">12.00</td>
<td align="left">10.00</td>
<td align="left">11.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Reset to default</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>quantile_type <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>The differences between Type 7 and Type 3 tend to be small for large
datasets, but they can be meaningful for small groups or when exact SAS
reconciliation is required. If your statistical analysis plan (SAP)
specifies SAS-compatible quantiles, set <code>quantile_type = 3</code>
at the start of your session.</p>
</div>
<div class="section level2">
<h2 id="precision-cap">Precision Cap<a class="anchor" aria-label="anchor" href="#precision-cap"></a>
</h2>
<p>When using tplyr2’s auto-precision system (format strings with
<code>a</code> or <code>A</code> characters), the integer and decimal
widths are determined dynamically from the data. This is useful when the
same format must accommodate variables with different scales, but
sometimes the data can drive widths to impractical extremes – a variable
recorded to six decimal places would produce very wide columns.</p>
<p>The <code>precision_cap</code> option lets you set a global ceiling
on auto-precision widths. It takes a named numeric vector with
<code>int</code> and/or <code>dec</code> components.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Without a cap, precision is driven entirely by the data</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"WEIGHTBL"</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"Weight (kg)"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"Mean (SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"a+1.a+1 (a+2.a+2)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_nocap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_nocap</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_nocap</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Auto-precision, no cap"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Auto-precision, no cap</caption>
<colgroup>
<col width="15%">
<col width="13%">
<col width="23%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Weight (kg)</td>
<td align="left">Mean (SD)</td>
<td align="left">62.76 ( 12.772)</td>
<td align="left">70.00 ( 14.653)</td>
<td align="left">67.28 ( 14.124)</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply a global cap: max 3 integer digits, max 1 decimal digit</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>precision_cap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>int <span class="op">=</span> <span class="fl">3</span>, dec <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_capped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_capped</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_capped</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Auto-precision, capped at int=3, dec=1"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Auto-precision, capped at int=3, dec=1</caption>
<colgroup>
<col width="15%">
<col width="13%">
<col width="23%">
<col width="23%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Weight (kg)</td>
<td align="left">Mean (SD)</td>
<td align="left">62.76 ( 12.772)</td>
<td align="left">70.00 ( 14.653)</td>
<td align="left">67.28 ( 14.124)</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Reset to default</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>precision_cap <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code>precision_cap</code> option serves as a global
default. If a specific layer provides its own <code>precision_cap</code>
in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>, the layer-level cap takes priority.
This gives you a safety net at the session level while allowing
individual layers to override when needed.</p>
</div>
<div class="section level2">
<h2 id="custom-summaries">Custom Summaries<a class="anchor" aria-label="anchor" href="#custom-summaries"></a>
</h2>
<p>Descriptive statistics layers in tplyr2 come with a set of built-in
summaries (<code>n</code>, <code>mean</code>, <code>sd</code>,
<code>median</code>, <code>var</code>, <code>min</code>,
<code>max</code>, <code>iqr</code>, <code>q1</code>, <code>q3</code>,
<code>missing</code>). When your study requires additional statistics
across many tables – geometric means, coefficients of variation, or any
other derived measure – you can register them at the session level so
they are available everywhere.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Register session-level custom summaries</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span></span>
<span>  custom_summaries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    geo_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">.var</span><span class="op">[</span><span class="va">.var</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    cv       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.var</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.var</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_desc.html">group_desc</a></span><span class="op">(</span><span class="st">"AGE"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"n"</span>              <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Mean (SD)"</span>      <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x (xx.xx)"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span>,</span>
<span>          <span class="st">"Geometric Mean"</span> <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.xx"</span>, <span class="st">"geo_mean"</span><span class="op">)</span>,</span>
<span>          <span class="st">"CV (%)"</span>         <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx.x"</span>, <span class="st">"cv"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">n</td>
<td align="left">86</td>
<td align="left">84</td>
<td align="left">84</td>
</tr>
<tr class="even">
<td align="left">Mean (SD)</td>
<td align="left">75.2 ( 8.59)</td>
<td align="left">74.4 ( 7.89)</td>
<td align="left">75.7 ( 8.29)</td>
</tr>
<tr class="odd">
<td align="left">Geometric Mean</td>
<td align="left">74.70</td>
<td align="left">73.94</td>
<td align="left">75.18</td>
</tr>
<tr class="even">
<td align="left">CV (%)</td>
<td align="left">11.4</td>
<td align="left">10.6</td>
<td align="left">11.0</td>
</tr>
</tbody>
</table>
<p>A few things to keep in mind about custom summaries:</p>
<ul>
<li>Each expression uses <code>.var</code> as a placeholder for the
target variable’s values within each group. At build time,
<code>.var</code> is replaced with the actual numeric vector.</li>
<li>Expressions should be wrapped in <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> to delay
evaluation.</li>
<li>If an expression throws an error for a particular group (e.g.,
trying <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> on non-positive values), tplyr2 catches the
error and returns <code>NA_real_</code> rather than stopping the
build.</li>
<li>Session-level custom summaries can be overridden by layer-level
<code>custom_summaries</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code>. This
means you can set study-wide defaults and still customize individual
layers.</li>
<li>A custom summary can even share a name with a built-in statistic
(e.g., <code>mean</code>), in which case it replaces the built-in
calculation.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reset to default</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span>custom_summaries <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scientific-notation-control">Scientific Notation Control<a class="anchor" aria-label="anchor" href="#scientific-notation-control"></a>
</h2>
<p>R may format very large or very small numbers in scientific notation
(e.g., <code>1e+05</code> instead of <code>100000</code>). This is
controlled by R’s <code>scipen</code> option, which sets a penalty
against scientific notation – higher values make it less likely. During
<code><a href="../reference/tplyr_build.html">tplyr_build()</a></code>, tplyr2 temporarily overrides
<code>scipen</code> to prevent scientific notation from appearing in
formatted output.</p>
<p>The default value of <code>9999</code> effectively guarantees that
scientific notation will never appear in your tables. In most cases, you
will not need to change this. However, if you have a specific reason to
allow scientific notation (or if you are debugging formatting), you can
adjust it:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the current value</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">tplyr2.scipen</span></span>
<span><span class="co">#&gt; [1] 9999</span></span></code></pre></div>
<p>The <code>scipen</code> override is applied only for the duration of
<code><a href="../reference/tplyr_build.html">tplyr_build()</a></code> and is automatically restored to its previous
value when the build completes. This means it will not affect other code
in your session.</p>
</div>
<div class="section level2">
<h2 id="resetting-options">Resetting Options<a class="anchor" aria-label="anchor" href="#resetting-options"></a>
</h2>
<p>To return all options to their defaults, set each one explicitly:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span></span>
<span>  IBMRounding     <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quantile_type   <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  precision_cap   <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_summaries <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scipen          <span class="op">=</span> <span class="fl">9999L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify</span></span>
<span><span class="fu"><a href="../reference/tplyr2_options.html">tplyr2_options</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $tplyr2.IBMRounding</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.quantile_type</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.precision_cap</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.custom_summaries</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $tplyr2.scipen</span></span>
<span><span class="co">#&gt; [1] 9999</span></span></code></pre></div>
<p>Because tplyr2 options are stored as standard R options (with the
<code>tplyr2.</code> prefix), they reset automatically when you start a
new R session. If you want your options to persist, place the
<code><a href="../reference/tplyr2_options.html">tplyr2_options()</a></code> call in your project’s
<code>.Rprofile</code> or at the top of your analysis script.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
