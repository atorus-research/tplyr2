<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Shift Layers • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shift Layers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shift Layers</h1>
            
      

      <div class="d-none name"><code>shift.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Shift tables are a common display in clinical trial reporting. They
summarize the change in a categorical state from one time point to
another – most often, the change in laboratory normal range indicator
from baseline to a post-baseline visit. The rows of a shift table
represent the “from” state (e.g., baseline normal range: Low, Normal,
High), and the columns represent the “to” state (e.g., post-baseline
normal range). Each cell contains a count or percentage of subjects who
moved from one category to another.</p>
<p>These tables give reviewers a quick, matrix-style view of how a
treatment affects lab values relative to their reference ranges.</p>
<p>In tplyr2, shift tables are built with <code><a href="../reference/group_shift.html">group_shift()</a></code>.
Under the hood, a shift layer is an abstraction of a count layer. It
reuses much of the same counting and formatting code, but the “column”
dimension of the shift variable is folded into the result columns
alongside the treatment variable. This means each result column
represents a treatment-by-shift-category combination, such as “Placebo |
Normal” or “Xanomeline High Dose | High”.</p>
<p>Because of this design, shift layers have a few limitations compared
to count layers:</p>
<ul>
<li>No nesting (only single-variable shifts)</li>
<li>No total rows or missing subject rows</li>
<li>No risk difference</li>
<li>No result-based sorting</li>
</ul>
<p>For most shift table needs, these limitations are not a concern. If
you need a text-style shift display (e.g., rows reading “Low to High”,
“Normal to High”), a standard <code><a href="../reference/group_count.html">group_count()</a></code> layer is a
better fit.</p>
</div>
<div class="section level2">
<h2 id="a-basic-example">A Basic Example<a class="anchor" aria-label="anchor" href="#a-basic-example"></a>
</h2>
<p>To demonstrate shift layers, we will create a small example dataset
that mimics a typical laboratory analysis dataset with baseline and
post-baseline normal range indicators.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create example shift data</span></span>
<span><span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SUBJ-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%03d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  TRTA    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Placebo"</span>, <span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span>,</span>
<span>                     each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  PARAM   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Creatine Kinase"</span>, <span class="st">"Alkaline Phosphatase"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  PARAMCD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CK"</span>, <span class="st">"ALP"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  VISIT   <span class="op">=</span> <span class="st">"WEEK 24"</span>,</span>
<span>  BNRIND  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="fl">60</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ANRIND  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="fl">60</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>With data in hand, building a shift table is straightforward. The key
difference from a count layer is the <code>target_var</code> argument:
instead of a single string, you pass a <strong>named character
vector</strong> with elements <code>"row"</code> and
<code>"column"</code>. The <code>"row"</code> element identifies the
variable that defines the row categories (the “from” state), and
<code>"column"</code> identifies the variable that produces additional
column groups (the “to” state).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  where <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"CK"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_shift.html">group_shift</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">"BNRIND"</span>, column <span class="op">=</span> <span class="st">"ANRIND"</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PARAM"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">adlb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="16%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">rowlabel3</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
<th align="left">res5</th>
<th align="left">res6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">H</td>
<td align="left">3 (30.0%)</td>
<td align="left">1 (10.0%)</td>
<td align="left">1 (10.0%)</td>
<td align="left">3 (30.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 (20.0%)</td>
</tr>
<tr class="even">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">N</td>
<td align="left">2 (20.0%)</td>
<td align="left">4 (40.0%)</td>
<td align="left">4 (40.0%)</td>
<td align="left">2 (20.0%)</td>
<td align="left">2 (20.0%)</td>
<td align="left">6 (60.0%)</td>
</tr>
</tbody>
</table>
<p>A few things to notice in this output:</p>
<ul>
<li>The <code>rowlabel1</code> and <code>rowlabel2</code> columns are
populated by the <code>by</code> variables (PARAM, VISIT), and
<code>rowlabel3</code> contains the values of the row shift variable
(BNRIND).</li>
<li>Each result column represents a treatment-by-ANRIND combination. The
column labels (stored as attributes) follow the pattern
<code>"Treatment | ANRIND (N=n)"</code>.</li>
<li>The default format is <code>"xx (xx.x%)"</code>, showing a count and
percentage, the same default used by count layers.</li>
</ul>
<p>However, you may notice that the only BNRIND values present in the
output are whatever happened to appear in the data. If a category like
“L” (Low) does not appear in the data, it will be absent from the table
entirely. Similarly, the sort order of rows depends on the alphabetical
order of the character values. Both of these problems have the same
solution: factors.</p>
</div>
<div class="section level2">
<h2 id="filling-missing-groups-using-factors">Filling Missing Groups Using Factors<a class="anchor" aria-label="anchor" href="#filling-missing-groups-using-factors"></a>
</h2>
<p>In R, factor variables carry two important pieces of information: the
set of all allowable levels and their order. When you convert your shift
variables to factors before building the table, tplyr2 uses the factor
levels to:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Complete the table</strong> – all levels appear as rows (and
in columns), even those with zero counts.</li>
<li>
<strong>Control sort order</strong> – rows follow the order of the
factor levels, not alphabetical order.</li>
</ol>
<p>This is especially important for shift tables, where the standard
presentation order is typically Low, Normal, High.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to factors with the desired level order</span></span>
<span><span class="va">adlb</span><span class="op">$</span><span class="va">BNRIND</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">adlb</span><span class="op">$</span><span class="va">BNRIND</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">adlb</span><span class="op">$</span><span class="va">ANRIND</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">adlb</span><span class="op">$</span><span class="va">ANRIND</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  where <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"CK"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_shift.html">group_shift</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">"BNRIND"</span>, column <span class="op">=</span> <span class="st">"ANRIND"</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PARAM"</span>, <span class="st">"VISIT"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx (xxx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">adlb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="11%">
<col width="7%">
<col width="7%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">rowlabel3</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
<th align="left">res5</th>
<th align="left">res6</th>
<th align="left">res7</th>
<th align="left">res8</th>
<th align="left">res9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">L</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">N</td>
<td align="left">2 ( 20.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">4 ( 40.0%)</td>
<td align="left">4 ( 40.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 20.0%)</td>
<td align="left">2 ( 20.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">6 ( 60.0%)</td>
</tr>
<tr class="odd">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">H</td>
<td align="left">3 ( 30.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 10.0%)</td>
<td align="left">1 ( 10.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 30.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">2 ( 20.0%)</td>
</tr>
</tbody>
</table>
<p>Now the table includes all three levels – L, N, and H – in both the
rows and the column groups, regardless of whether any subjects actually
fell into those categories. Cells with no observations display as
<code>" 0 (  0.0%)"</code>, maintaining consistent alignment. The rows
also follow the factor level order (L, N, H) rather than alphabetical
order (H, L, N).</p>
<p>This pattern of using factors to control completeness and ordering
applies broadly across tplyr2, but it is particularly important for
shift tables where the matrix structure must be complete to be
interpretable.</p>
</div>
<div class="section level2">
<h2 id="customizing-the-format">Customizing the Format<a class="anchor" aria-label="anchor" href="#customizing-the-format"></a>
</h2>
<p>Like count layers, shift layers accept format strings through
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>. You can display just counts, just
percentages, or any combination. The format string system is the same
one used across all of tplyr2.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Counts only</span></span>
<span><span class="va">spec_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  where <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"CK"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_shift.html">group_shift</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">"BNRIND"</span>, column <span class="op">=</span> <span class="st">"ANRIND"</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PARAM"</span>, <span class="st">"VISIT"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec_counts</span>, <span class="va">adlb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result_counts</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^ord_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result_counts</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="12%">
<col width="12%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">rowlabel3</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
<th align="left">res5</th>
<th align="left">res6</th>
<th align="left">res7</th>
<th align="left">res8</th>
<th align="left">res9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">L</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">N</td>
<td align="left">2</td>
<td align="left">0</td>
<td align="left">4</td>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">0</td>
<td align="left">6</td>
</tr>
<tr class="odd">
<td align="left">Creatine Kinase</td>
<td align="left">WEEK 24</td>
<td align="left">H</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="one-thing-to-note">One Thing to Note<a class="anchor" aria-label="anchor" href="#one-thing-to-note"></a>
</h2>
<p>The <code><a href="../reference/group_shift.html">group_shift()</a></code> API is designed specifically for
matrix-style shift tables, where baseline categories form the rows and
post-baseline categories form the columns. This cross-tabulation style
is the most common shift table format in clinical reporting.</p>
<p>However, not all shift displays take this form. Sometimes you may
need a text-based summary where each row describes a specific
transition, such as “Low to High” or “Normal to Normal”. For that style
of display, <code><a href="../reference/group_count.html">group_count()</a></code> is the right tool. You would
create a derived variable in your data that concatenates the baseline
and post-baseline values (e.g.,
<code>paste(BNRIND, "to", ANRIND)</code>) and then count that variable
directly.</p>
</div>
<div class="section level2">
<h2 id="where-to-go-from-here">Where to Go From Here<a class="anchor" aria-label="anchor" href="#where-to-go-from-here"></a>
</h2>
<p>Shift layers share much of their underlying machinery with count
layers, so many of the concepts from the count layer documentation apply
here as well. For further reading:</p>
<ul>
<li>The <strong>denominator</strong> vignette covers how denominators
are computed and how to customize them, which directly affects the
percentages displayed in shift tables.</li>
<li>The <strong>sorting and ordering</strong> vignette explains how row
and column ordering works, including the role of factor levels that we
touched on in this vignette.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
