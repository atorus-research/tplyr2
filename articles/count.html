<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Count Layers • tplyr2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Count Layers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tplyr2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tplyr2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/table.html">Table Properties</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Layer Basics</h6></li>
    <li><a class="dropdown-item" href="../articles/desc.html">Descriptive Statistics Layers</a></li>
    <li><a class="dropdown-item" href="../articles/count.html">Count Layers</a></li>
    <li><a class="dropdown-item" href="../articles/shift.html">Shift Layers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Formatting</h6></li>
    <li><a class="dropdown-item" href="../articles/general_string_formatting.html">General String Formatting</a></li>
    <li><a class="dropdown-item" href="../articles/desc_layer_formatting.html">Advanced Descriptive Statistics Formatting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Table Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/sort.html">Sorting a tplyr2 Table</a></li>
    <li><a class="dropdown-item" href="../articles/denom.html">Denominators</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">tplyr2 Options</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Metadata</h6></li>
    <li><a class="dropdown-item" href="../articles/metadata.html">Metadata and Traceability</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/riskdiff.html">Risk Difference</a></li>
    <li><a class="dropdown-item" href="../articles/analyze.html">Custom Analysis Layers</a></li>
    <li><a class="dropdown-item" href="../articles/serialization.html">Spec Serialization</a></li>
    <li><a class="dropdown-item" href="../articles/ard.html">Analysis Results Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Post-Processing</h6></li>
    <li><a class="dropdown-item" href="../articles/post_processing.html">Post-Processing</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Migration</h6></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migrating from Tplyr v1</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Count Layers</h1>
            
      

      <div class="d-none name"><code>count.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tplyr2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Counting things seems simple enough. You look at the data, tally up
how many observations fall into each category, and move on. But in
clinical reporting, counting is deceptively nuanced. A demographics
table needs simple frequencies. An adverse events table needs both the
number of subjects who experienced an event and the total number of
events. A disposition table might need all of those plus custom column
groupings and sorting by frequency.</p>
<p>tplyr2 handles all of these scenarios through
<code><a href="../reference/group_count.html">group_count()</a></code>. In this vignette, we will walk through the
most common counting patterns you will encounter when building clinical
tables, starting with the basics and building up to nested hierarchical
summaries.</p>
</div>
<div class="section level2">
<h2 id="a-simple-count">A Simple Count<a class="anchor" aria-label="anchor" href="#a-simple-count"></a>
</h2>
<p>The simplest use of <code><a href="../reference/group_count.html">group_count()</a></code> is to count the levels
of a single categorical variable. Here we build a basic disposition
table showing the reasons subjects discontinued from the study, broken
out by planned treatment group.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">40 (47.6%)</td>
<td align="left">44 (52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (67.4%)</td>
<td align="left">27 (32.1%)</td>
<td align="left">25 (29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 (10.5%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="left">10 (11.9%)</td>
</tr>
</tbody>
</table>
<p>By default, tplyr2 formats counts as <code>n (xx.x%)</code>, where
the denominator is the total number of observations within each
treatment column. Every level present in the data gets a row, and zero
counts are filled in automatically so that no treatment arm is left with
a gap.</p>
<div class="section level3">
<h3 id="adding-a-total-column">Adding a Total Column<a class="anchor" aria-label="anchor" href="#adding-a-total-column"></a>
</h3>
<p>In many tables, you need a “Total” column that pools all treatment
groups. You can add one at the spec level with
<code><a href="../reference/total_group.html">total_group()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  total_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/total_group.html">total_group</a></span><span class="op">(</span><span class="st">"TRT01P"</span>, label <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"res4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="38%">
<col width="15%">
<col width="16%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">92 (36.2%)</td>
<td align="left">40 (47.6%)</td>
<td align="left">44 (52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (67.4%)</td>
<td align="left">110 (43.3%)</td>
<td align="left">27 (32.1%)</td>
<td align="left">25 (29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">4 ( 1.6%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 0.8%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">3 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">6 ( 2.4%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">7 ( 2.8%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 (10.5%)</td>
<td align="left">27 (10.6%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="left">10 (11.9%)</td>
</tr>
</tbody>
</table>
<p>The <code><a href="../reference/total_group.html">total_group()</a></code> function works by duplicating every
row in the data with the treatment variable set to the label you provide
(here, “Total”). This means the total column is computed through the
same pipeline as every other column, keeping the logic consistent.</p>
</div>
<div class="section level3">
<h3 id="custom-column-groups">Custom Column Groups<a class="anchor" aria-label="anchor" href="#custom-column-groups"></a>
</h3>
<p>Sometimes you need to combine existing treatment arms into a new
group. For example, you might want a “Treated” column that pools all
active dose groups. The <code><a href="../reference/custom_group.html">custom_group()</a></code> function handles
this.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  custom_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/custom_group.html">custom_group</a></span><span class="op">(</span><span class="st">"TRT01P"</span>,</span>
<span>      <span class="st">"Treated"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xanomeline High Dose"</span>, <span class="st">"Xanomeline Low Dose"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span>, <span class="st">"res4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="38%">
<col width="15%">
<col width="15%">
<col width="15%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
<th align="left">res4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">84 (50.0%)</td>
<td align="left">40 (47.6%)</td>
<td align="left">44 (52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (67.4%)</td>
<td align="left">52 (31.0%)</td>
<td align="left">27 (32.1%)</td>
<td align="left">25 (29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">1 ( 0.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">1 ( 0.6%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">1 ( 0.6%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">4 ( 2.4%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">5 ( 3.0%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 (10.5%)</td>
<td align="left">18 (10.7%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="left">10 (11.9%)</td>
</tr>
</tbody>
</table>
<p>Like <code><a href="../reference/total_group.html">total_group()</a></code>, custom groups duplicate the matching
rows with the treatment variable set to the new label. Custom groups and
total groups can be combined in a single spec when you need both.</p>
</div>
<div class="section level3">
<h3 id="custom-format-strings">Custom Format Strings<a class="anchor" aria-label="anchor" href="#custom-format-strings"></a>
</h3>
<p>The default <code>n (xx.x%)</code> format works for many tables, but
you have full control over how counts are displayed through the
<code><a href="../reference/f_str.html">f_str()</a></code> function. Format strings use <code>x</code>
characters to define field widths: each <code>x</code> reserves one
character position.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xxx.x%)"</span>, <span class="st">"n"</span>, <span class="st">"pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">40 ( 47.6%)</td>
<td align="left">44 ( 52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 ( 67.4%)</td>
<td align="left">27 ( 32.1%)</td>
<td align="left">25 ( 29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="odd">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 ( 10.5%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="left">10 ( 11.9%)</td>
</tr>
</tbody>
</table>
<p>The available count statistics are:</p>
<ul>
<li>
<code>n</code> – the number of observations</li>
<li>
<code>pct</code> – the percentage of observations (using the column
total as denominator)</li>
<li>
<code>total</code> – the denominator used for the percentage
calculation</li>
<li>
<code>distinct_n</code> – the number of distinct subjects (requires
<code>distinct_by</code>)</li>
<li>
<code>distinct_pct</code> – the percentage of distinct subjects</li>
<li>
<code>distinct_total</code> – the distinct denominator</li>
</ul>
<p>You can combine any of these in a single format string. We will use
the distinct variants in the next section.</p>
</div>
<div class="section level3">
<h3 id="total-rows">Total Rows<a class="anchor" aria-label="anchor" href="#total-rows"></a>
</h3>
<p>Many tables require a “Total” row at the bottom of each count block.
Set <code>total_row = TRUE</code> in <code><a href="../reference/layer_settings.html">layer_settings()</a></code> to
add one.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRT01P"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"DCDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        total_row <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        total_row_label <span class="op">=</span> <span class="st">"Overall Total"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ADVERSE EVENT</td>
<td align="left">8 ( 9.3%)</td>
<td align="left">40 (47.6%)</td>
<td align="left">44 (52.4%)</td>
</tr>
<tr class="even">
<td align="left">COMPLETED</td>
<td align="left">58 (67.4%)</td>
<td align="left">27 (32.1%)</td>
<td align="left">25 (29.8%)</td>
</tr>
<tr class="odd">
<td align="left">DEATH</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">LACK OF EFFICACY</td>
<td align="left">3 ( 3.5%)</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">LOST TO FOLLOW-UP</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="even">
<td align="left">Overall Total</td>
<td align="left">86 (100.0%)</td>
<td align="left">84 (100.0%)</td>
<td align="left">84 (100.0%)</td>
</tr>
<tr class="odd">
<td align="left">PHYSICIAN DECISION</td>
<td align="left">1 ( 1.2%)</td>
<td align="left">2 ( 2.4%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">PROTOCOL VIOLATION</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">1 ( 1.2%)</td>
</tr>
<tr class="odd">
<td align="left">STUDY TERMINATED BY SPONSOR</td>
<td align="left">2 ( 2.3%)</td>
<td align="left">3 ( 3.6%)</td>
<td align="left">2 ( 2.4%)</td>
</tr>
<tr class="even">
<td align="left">WITHDRAWAL BY SUBJECT</td>
<td align="left">9 (10.5%)</td>
<td align="left">8 ( 9.5%)</td>
<td align="left">10 (11.9%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="distinct-versus-event-counts">Distinct Versus Event Counts<a class="anchor" aria-label="anchor" href="#distinct-versus-event-counts"></a>
</h2>
<p>When summarizing adverse events, the distinction between events and
subjects matters enormously. A single subject might experience the same
event multiple times. If you simply count rows, you are counting events.
If you want the number of subjects who experienced each event at least
once, you need distinct counts.</p>
<p>The <code>distinct_by</code> parameter in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code> tells tplyr2 which variable identifies
unique subjects. Once set, the <code>distinct_n</code> and
<code>distinct_pct</code> statistics become available for use in format
strings.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="st">"AEDECOD"</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%) [xxx]"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="36%">
<col width="21%">
<col width="21%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ABDOMINAL PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="even">
<td align="left">AGITATION</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="odd">
<td align="left">ANXIETY</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE DERMATITIS</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE ERYTHEMA</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">3 ( 7.0%) [ 3]</td>
<td align="left">4 ( 8.0%) [ 4]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE IRRITATION</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">3 ( 7.0%) [ 4]</td>
<td align="left">2 ( 4.0%) [ 2]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE PAIN</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.3%) [ 1]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE PRURITUS</td>
<td align="left">4 (12.5%) [ 4]</td>
<td align="left">6 (14.0%) [ 7]</td>
<td align="left">5 (10.0%) [ 5]</td>
</tr>
<tr class="odd">
<td align="left">APPLICATION SITE REACTION</td>
<td align="left">1 ( 3.1%) [ 1]</td>
<td align="left">1 ( 2.3%) [ 1]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
</tr>
<tr class="even">
<td align="left">APPLICATION SITE URTICARIA</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">0 ( 0.0%) [ 0]</td>
<td align="left">1 ( 2.0%) [ 1]</td>
</tr>
</tbody>
</table>
<p>In this output, the first number is the count of distinct subjects,
the percentage is based on distinct subjects, and the number in brackets
is the total event count. This pattern – <code>xxx (xx.x%) [xxx]</code>
for distinct subjects, percent, and events – is one of the most common
formats for adverse event tables.</p>
<div class="section level3">
<h3 id="a-note-on-parenthesis-hugging">A Note on Parenthesis Hugging<a class="anchor" aria-label="anchor" href="#a-note-on-parenthesis-hugging"></a>
</h3>
<p>You may notice that tplyr2 carefully aligns numbers within their
format fields, padding with leading spaces so that decimal points and
parentheses line up across rows. For even tighter alignment, tplyr2
supports “parenthesis hugging” using uppercase <code>X</code> characters
in format strings. When you use <code>X</code> instead of
<code>x</code>, leading spaces shift outside the parenthesis so the
opening delimiter sits right next to the number. This is a more advanced
feature covered in detail in the format strings documentation.</p>
</div>
</div>
<div class="section level2">
<h2 id="nested-count-summaries">Nested Count Summaries<a class="anchor" aria-label="anchor" href="#nested-count-summaries"></a>
</h2>
<p>Adverse event tables in clinical reports almost always use a
hierarchical structure: body system (SOC) as the outer grouping and
preferred term (PT) as the inner grouping. tplyr2 supports this directly
by passing a vector of two variable names to
<code><a href="../reference/group_count.html">group_count()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="41%">
<col width="29%">
<col width="9%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">2 ( 4.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">TACHYCARDIA</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left"></td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left">VENTRICULAR SEPTAL DEFECT</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">GASTROINTESTINAL DISORDERS</td>
<td align="left"></td>
<td align="left">6 (18.8%)</td>
<td align="left">4 ( 9.3%)</td>
<td align="left">3 ( 6.0%)</td>
</tr>
</tbody>
</table>
<p>The first variable in the vector (<code>AEBODSYS</code>) becomes the
outer level, and the second (<code>AEDECOD</code>) becomes the inner
level. In the output, <code>rowlabel1</code> holds the body system name
and <code>rowlabel2</code> holds the preferred term. Outer-level summary
rows have an empty <code>rowlabel2</code>, while inner-level rows have
their preferred term indented within <code>rowlabel2</code>.</p>
<p>The outer-level counts represent the number of distinct subjects with
any event in that body system, and the inner-level counts represent
subjects with each specific preferred term. A subject who experienced
multiple different preferred terms within the same body system is
counted once at the outer level but once for each preferred term at the
inner level.</p>
<div class="section level3">
<h3 id="collapsing-row-labels">Collapsing Row Labels<a class="anchor" aria-label="anchor" href="#collapsing-row-labels"></a>
</h3>
<p>For display purposes, you often want a single row label column with
indentation indicating the hierarchy rather than two separate columns.
The <code><a href="../reference/collapse_row_labels.html">collapse_row_labels()</a></code> function merges the
<code>rowlabel</code> columns into one.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_row_labels.html">collapse_row_labels</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, indent <span class="op">=</span> <span class="st">"   "</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">collapsed</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row_label"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="58%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">row_label</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">2 ( 4.0%)</td>
</tr>
<tr class="odd">
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">TACHYCARDIA</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">CONGENITAL, FAMILIAL AND GENETIC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
</tbody>
</table>
<p>The <code>indent</code> parameter controls the string used for each
level of nesting. Here we use three spaces, but you can use any string
that suits your output format.</p>
</div>
<div class="section level3">
<h3 id="controlling-indentation-at-the-layer-level">Controlling Indentation at the Layer Level<a class="anchor" aria-label="anchor" href="#controlling-indentation-at-the-layer-level"></a>
</h3>
<p>You can also control the indentation of inner-level labels directly
in the layer settings using the <code>indentation</code> parameter. This
sets the prefix applied to <code>rowlabel2</code> values before any
post-processing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        indentation <span class="op">=</span> <span class="st">"    "</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx"</span>, <span class="st">"n"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">rowlabel1</th>
<th align="left">rowlabel2</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left">5</td>
<td align="left">6</td>
<td align="left">6</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">TACHYCARDIA</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">CARDIAC DISORDERS</td>
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="nested-counts-with-total-rows">Nested Counts with Total Rows<a class="anchor" aria-label="anchor" href="#nested-counts-with-total-rows"></a>
</h3>
<p>Total rows work with nested counts as well. When
<code>total_row = TRUE</code> is set on a nested layer, the total row
reflects the overall count across all body systems.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_spec.html">tplyr_spec</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>  layers <span class="op">=</span> <span class="fu"><a href="../reference/tplyr_layers.html">tplyr_layers</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/group_count.html">group_count</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEBODSYS"</span>, <span class="st">"AEDECOD"</span><span class="op">)</span>,</span>
<span>      settings <span class="op">=</span> <span class="fu"><a href="../reference/layer_settings.html">layer_settings</a></span><span class="op">(</span></span>
<span>        distinct_by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>        total_row <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        total_row_label <span class="op">=</span> <span class="st">"Any adverse event"</span>,</span>
<span>        format_strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          n_counts <span class="op">=</span> <span class="fu"><a href="../reference/f_str.html">f_str</a></span><span class="op">(</span><span class="st">"xxx (xx.x%)"</span>, <span class="st">"distinct_n"</span>, <span class="st">"distinct_pct"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tplyr_build.html">tplyr_build</a></span><span class="op">(</span><span class="va">spec</span>, <span class="va">tplyr_adae</span><span class="op">)</span></span>
<span><span class="va">collapsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_row_labels.html">collapse_row_labels</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"rowlabel1"</span>, <span class="st">"rowlabel2"</span>, indent <span class="op">=</span> <span class="st">"   "</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">collapsed</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"row_label"</span>, <span class="st">"res1"</span>, <span class="st">"res2"</span>, <span class="st">"res3"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">row_label</th>
<th align="left">res1</th>
<th align="left">res2</th>
<th align="left">res3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Any adverse event</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">32 (100.0%)</td>
<td align="left">43 (100.0%)</td>
<td align="left">50 (100.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC DISORDERS</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">4 (12.5%)</td>
<td align="left">6 (14.0%)</td>
<td align="left">5 (10.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL FIBRILLATION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">ATRIAL FLUTTER</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">ATRIAL HYPERTROPHY</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">BUNDLE BRANCH BLOCK RIGHT</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">CARDIAC FAILURE CONGESTIVE</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="even">
<td align="left">MYOCARDIAL INFARCTION</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">2 ( 4.0%)</td>
</tr>
<tr class="odd">
<td align="left">SINUS BRADYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">3 ( 7.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">SUPRAVENTRICULAR EXTRASYSTOLES</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="odd">
<td align="left">SUPRAVENTRICULAR TACHYCARDIA</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.0%)</td>
</tr>
<tr class="even">
<td align="left">TACHYCARDIA</td>
<td align="left">1 ( 3.1%)</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
<tr class="odd">
<td align="left">VENTRICULAR EXTRASYSTOLES</td>
<td align="left">0 ( 0.0%)</td>
<td align="left">1 ( 2.3%)</td>
<td align="left">0 ( 0.0%)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="where-to-go-from-here">Where to Go from Here<a class="anchor" aria-label="anchor" href="#where-to-go-from-here"></a>
</h2>
<p>Count layers in tplyr2 cover a wide range of clinical table patterns,
but there is much more to explore. Here are some related topics covered
in other vignettes:</p>
<ul>
<li>
<strong>Denominators</strong>: Control how percentages are
calculated with <code>denoms_by</code> and <code>denom_ignore</code> in
<code><a href="../reference/layer_settings.html">layer_settings()</a></code>.</li>
<li>
<strong>Missing counts</strong>: Add rows for missing values with
the <code>missing_count</code> parameter.</li>
<li>
<strong>Shift tables</strong>: Use <code><a href="../reference/group_shift.html">group_shift()</a></code> for
cross-tabulation of baseline versus post-baseline categories.</li>
<li>
<strong>Descriptive statistics</strong>: Use
<code><a href="../reference/group_desc.html">group_desc()</a></code> for continuous variable summaries like mean,
median, and standard deviation.</li>
<li>
<strong>Post-processing</strong>: Apply row masks, conditional
formatting, and row label collapsing to polish your final output.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
